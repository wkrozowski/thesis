\chapter{Behavioural Distance of Regular Expressions}
\label{chapter2}
Deterministic automata have been traditionally studied through the point of view of language equivalence. Another perspective is given by the notion of \emph{shortest-distinguishing-word} distance quantifying the dissimilarity of states. To illustrate that notion of distance, consider the following three deterministic finite automata:

\begin{figure*}[h!]
\[
\begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto,every node/.style={scale=1}]

  \node[initial,state,accepting]  (q_0)                      {$\mathbf{q_0}$};
  \path[->] (q_0) edge [loop above] node {a} ();
  \node [initial, state, accepting] (r_0) [right= 3 cm of q_0] {$\mathbf{r_0}$};
  \node [state,accepting] (r_1) [right= of r_0] {$\mathbf{r_1}$};
  \node [state] (r_2) [right= of r_1] {$\mathbf{r_2}$}; 
  \path[->] (r_0) edge node {a} (r_1);
  \path[->] (r_1) edge node {a} (r_2);
  \path[->] (r_2) edge [loop above] node {a} ();
  \node[initial, state] (s_0) [right= 3 cm of r_2] {$\mathbf{s_0}$};
  \path[->] (s_0) edge [loop above] node {a} ();
\end{tikzpicture}
\]
\caption{Three inequivalent DFAs}	
\label{c2:fig:dfas}
\end{figure*}

Neither of the above automata are language equivalent. Their languages are respectively: $\{\emptyword, a, aa, aaa, \dots\}$, $\{\emptyword, a\}$, and $\emptyset$ (we use $\emptyword$ to denote the empty word). However, one could argue that the behaviour of the middle automaton is closer to the one on the left rather than the one on the right. In particular, languages of the left and middle automaton agree on all words of length less than two, while the left and right one disagree on all words. 

One can make this idea precise, by providing a \emph{shortest-distinguishing-word} metric $\langmetric \colon \pset (\alphabet^*) \times \pset (\alphabet^*) \to [0,1]$ on the set of all formal languages over some fixed alphabet $\alphabet$ given by the following formula, where $\lambda \in \interval[open]{0}{1}$ and $L, M \subseteq \alphabet^*$:
\begin{equation}\label{c2:eq:shortest_distinguishing_word}
	d_{\mathcal{L}}(L, M) = \begin{cases}
\lambda^{|w|} & w \text{ is the shortest word that belongs to only one of } L \text{ and } M\\
0 & \text{if } L = M
\end{cases}
\end{equation}

If we set $\lambda = \frac{1}{2}$, then
\begin{gather*}
	\langmetric(\{\emptyword, a, aa, aaa, \dots\}, \{\emptyword, a\}) = \frac{1}{4} \quad \text{ and } \quad \langmetric(\{\emptyword,a,aa,aaa, \dots\}, \emptyset)=1
\end{gather*}
This allows us to formally state that the behaviour of the middle automaton is a better approximation of the left one, rather than the right one. Observe, that we excluded $\lambda=0$ and $\lambda=1$, as in both cases $\langmetric$ would become a pseudometric setting all languages to be at distance zero or one, without providing any quantitative information. 


Equivalently, languages accepted by automata depicted on the \Cref{c2:fig:dfas} can be represented using regular expressions $a^*$, $a + 1$ and $0$ respectively.  To determine the distance between arbitrary regular expressions $e$ and $f$ one would have to construct corresponding deterministic finite automata and calculate (or approximate) the distance between their languages. Instead, as a main contribution of this chapter, we present a sound and complete quantitative inference system for reasoning about the shortest-distinguishing-word distance of languages denoted by regular expressions in question.

Since we are dealing with distances, rather than strict equality, we cannot rely on classical equational logic as a basis for our inference system. Instead, we rely on the quantitative analogue of equational logic~\cite{Mardare:2016:Quantitative}, which deals with the statements of the form $e \equiv_{\e} f$, intuitively meaning \emph{term $e$ is within the distance of at most $\e \in \Q$ from the term $f$}. While the existing work~\cite{Bacci:2018:Algebraic,Bacci:2018:Bisimilarity,Bacci:2018:TV} looked at quantitative axiomatisations of behavioural distance for probabilistic transition systems calculated through the Kantorovich lifting, which can be thought of as a special case of the abstract coalgebraic framework relying on lifting endofunctors to the category of pseudometric spaces~\cite{Baldan:2018:Coalgebraic}, axiomatising behavioural distances for other kinds of transition systems have received little to no attention.

It turns out that the approach to completeness used in~\cite{Bacci:2018:Bisimilarity} relies on properties which are not unique to distances obtained through the Kantorovich lifting and can be employed to give complete axiomatisations of behavioural distances for other kinds of transition systems obtained through the coalgebraic framework~\cite{Baldan:2018:Coalgebraic}. In this chapter, as a starting point, we look at one of the simplest instantiations of that abstract framework in the case of deterministic automata, yielding \emph{shortest-distinguishing-word} distance. 

Formally speaking, if $\sem{-}: \RExp \to \pset (\alphabet^*)$ is the function taking regular expressions to their languages, then our inference system satisfies the following:
$$
	\vdash e \equiv_\e f \iff \langmetric(\llbracket e \rrbracket, \llbracket f \rrbracket) \leq \e
$$ 

The rest of the chapter is organised is as follows:

In \Cref{c2:sec:preliminaries} we review basic definitions from the field of universal coalgebra~\cite{Rutten:2000:Universal,Gumm:2000:Elements} and automata theory. In particular, we recall the semantics of regular expressions through Brzozowski derivatives~\cite{Brzozowski:1964:Expressions}. Then, in order to talk about distances, we state basic definitions and properties surrounding (pseudo)metric spaces.

In \Cref{c2:sec:behavioural_distance} we recall the central notions of the abstract framework of coalgebraic behavioural metrics~\cite{Baldan:2018:Coalgebraic} and discuss its concrete instatiation to the concrete case of deterministic automata that yields shortest-distinguishing-word distance.
	
In \Cref{c2:sec:quantitative_axiomatisation} we introduce a quantitative inference system for reasoning about the shortest-distinguishing-word distance of regular expressions. We recall the definitions surrounding the quantitative equational theories~\cite{Mardare:2016:Quantitative} from the literature. We then present the rules of our inference system, give soundness result and provide a discussion about the axioms. The interesting insight is that when relying on quantitative equational theories which contain an infinitary rule capturing the notion of convergence, there is no need for any fixpoint introduction rule. We illustrate this by axiomatically deriving Salomaa's fixpoint rule for regular expressions~\cite{Salomaa:1966:Two}.

The key result of our paper is contained in \Cref{c2:sec:completeness}, where we prove completeness of our inference system. The heart of the argument relies on showing that the behavioural distance of regular expressions can be approximated from above using Kleene's fixpoint theorem, which can be then mimicked through the means of axiomatic reasoning. This part of the paper makes heavy use of the order-theoretic and Banach space structures carried by the sets of pseudometrics over a given set.

We conclude in \Cref{c2:sec:discussion}, review related literature, and sketch directions for future work.

\section{Preliminaries}\label{c2:sec:preliminaries}
In this section, we recall the main definitions and results from the literature that this and further chapters rely on. Throughout this thesis, we assume the familiarity of the reader with basic notions of category theory~\cite{Abramsky:2010:Introduction} and order theory~\cite{Davey:2002:Introduction}. Notation wise, given a category $\C$, we will write $\ObjC(\C)$ for the collection of its objects. For $X,Y \in \ObjC(\C)$, we will write $\C(X,Y)$ for the hom-object between objets $X$ and $Y$. We will write $f \colon X \to Y$, to denote that $f$ is a morphism from $X$ to $Y$.
\subsection{Coalgebra}\label{c2:subsec:coalgebra}

Let $\C$ be a category.  An $\funB$-coalgebra is a pair $(X, \alpha \colon X \to \funB X)$, where $X \in \ObjC(\C)$ and $\funB \colon \C \to \C$ is an endofunctor on $\C$. We call $\funB$ a \emph{type functor} and refer to $X$ and $\alpha$ as \emph{state space} (or a \emph{carrier}) and \emph{transition structure} respectively. We will omit writing $\funB$ when it is obvious from the context. A homomorphism $f \colon (X, \alpha) \to (Y, \beta)$ of coalgebras is an arrow $f \colon X \to Y$ in $\C$ making the following diagram commute:

% https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzAsMSwiXFxmdW5GIFgiXSxbMiwwLCJZIl0sWzIsMSwiXFxmdW5GIFkiXSxbMCwyLCJmIl0sWzIsMywiXFxiZXRhIl0sWzAsMSwiXFxhbHBoYSIsMl0sWzEsMywiXFxmdW5GIGYiLDJdXQ==
\[\begin{tikzcd}
	X && Y \\
	{\funB X} && {\funB Y}
	\arrow["f", from=1-1, to=1-3]
	\arrow["\alpha"', from=1-1, to=2-1]
	\arrow["\beta", from=1-3, to=2-3]
	\arrow["{\funB f}"', from=2-1, to=2-3]
\end{tikzcd}\]
$\funB$-coalgebras and their homomorphisms form a category $\coa{\funB}$. 

\begin{definition}\label{c2:def:final_coalgebra}
We call a coalgebra $(\nu \funB, t)$ \emph{final} if for any coalgebra $(X, \alpha)$, there exists a unique homomorphism $\beh\alpha \colon (X, \alpha) \to (\nu \funB, t)$. A final coalgebra (if it exists) is precisely the final object in $\coa{\funB}$.	
\end{definition}

If $\C$ is a concrete category, that is equipped with a faithful functor $\forget \colon \C \to \Set$, one can define the notion of \emph{behavioural equivalence}. All coalgebras considered in this thesis are defined over concrete categories.
\begin{definition}\label{c2:def:behavioural_equivalence}
Given $\funB$-coalgebras $(X, \alpha)$ and $(Y, \beta)$, and elements $x \in \forget X$, $y \in \forget Y$, we say that $x$ is behaviourally equivalent to $y$ (written $x \beheq y$), if there exists a third coalgebra $(Z, \gamma)$ and $\funB$-coalgebra homomorphisms $f \colon (X, \alpha) \to (Z, \gamma)$ and $g \colon (Y, \beta) \to (Z, \gamma)$, such that $\forget f(x)=\forget g(x)$.	
\end{definition}


For the remainder of this subsection, we will focus on properties of coalgebras for endofunctors over $\Set$ by setting $\funB \colon \Set \to \Set$. For such coalgebras, one can phrase the notion of \emph{coalgebraic bisimulation}.
\begin{definition}\label{c2:def:bisimulation}
Let $(X, \alpha)$ and $(Y, \beta)$ be two coalgebras for the functor $\funB \colon \Set \to \Set$. We call a relation ${R} \subseteq {X \times Y}$ a bisimulation if there exists a transition function $R \to \funB R$ making the following diagram commute:
% https://q.uiver.app/#q=WzAsNixbMCwwLCJYIl0sWzIsMCwiUiJdLFs0LDAsIlkiXSxbMiwxLCJcXGZ1bkYgUiJdLFswLDEsIlxcZnVuRiBYIl0sWzQsMSwiXFxmdW5GIFkiXSxbMCw0LCJcXGFscGhhIl0sWzEsM10sWzIsNSwiXFxiZXRhIl0sWzEsMiwiXFxwaV8yIl0sWzMsNSwiXFxmdW5GIFxccGlfMiIsMl0sWzEsMCwiXFxwaV8xIiwyXSxbMyw0LCJcXGZ1bkYgXFxwaV8xIl1d
\[\begin{tikzcd}
	X && R && Y \\
	{\funB X} && {\funB R} && {\funB Y}
	\arrow["\alpha", from=1-1, to=2-1]
	\arrow["{\pi_1}"', from=1-3, to=1-1]
	\arrow["{\pi_2}", from=1-3, to=1-5]
	\arrow[from=1-3, to=2-3]
	\arrow["\beta", from=1-5, to=2-5]
	\arrow["{\funB \pi_1}", from=2-3, to=2-1]
	\arrow["{\funB \pi_2}"', from=2-3, to=2-5]
\end{tikzcd}\]	
\end{definition}

In the above, $\pi_1 \colon R \to X$ and $\pi_2 \colon R \to Y$ are the canonical projection maps given by the product structure on $X\times Y$. Given $\langle x,y \rangle \in X \times Y$, we write $x \sim y$ if there exists a bisimulation $R$ between $(X, \alpha)$ and $(Y, \gamma)$, such that $\langle x,y \rangle \in R$. Moreover, constructing bisimulations is a sound technique for proving behavioural equivalence. It is also complete upon imposing a mild restriction on $\funB$.
\begin{lemma}[{\cite[Theorem~9.3]{Rutten:2000:Universal}}]\label{c2:lem:behavioural_equivalence}
We have that
$
x \sim y \implies x \beheq y
$. The converse is true if $\funB$ preserves weak pullbacks.	
\end{lemma}
Bisimulations and homomorphisms are related via the following lemma:
\begin{lemma}[{\cite[Theorem~2.5]{Rutten:2000:Universal}}]\label{c2:lem:functional_bisimulation}
	Let $(X, \alpha)$ and $(Y, \beta)$ be two coalgebras. A function $f \colon X \to Y$ is a homomorphism if and only if $G(f) = \{\langle x, f(x) \rangle \mid x \in X\} \subseteq X \times Y$ is a bisimulation.
\end{lemma}
We call a bisimulation that is an equivalence relation a bisimulation equivalence. Forming a quotient using bisimulation equivalences can be used to construct quotient coalgebras.
\begin{lemma}[{\cite[Proposition~5.8]{Rutten:2000:Universal}}]\label{c2:lem:quotient_coalgebra}
	Let $R \subseteq {X \times X}$ be a bisimulation equivalence on a coalgebra $(X, \alpha)$. Let $[-]_{R} \colon X \to {X}/{R}$, be the canonical quotient map of $R$. Then, there is a unique transition structure $\overline{\alpha} \colon {X}/{R} \to \funB {X}/{R}$ on ${X}/{R}$, that makes $[-]_R$ into a coalgebra homomorphism, thus making the following diagram commute:
	 % https://q.uiver.app/#q=WzAsNCxbMCwwLCJYIl0sWzIsMCwie1h9L3tSfSJdLFsyLDEsIlxcZnVuRiB7WH0ve1J9Il0sWzAsMSwiXFxmdW5GIFgiXSxbMCwzLCJcXGFscGhhIl0sWzEsMiwiXFxvdmVybGluZVxcYWxwaGEiXSxbMCwxLCJbLV1fUiJdLFszLDIsIlxcZnVuRiBbLV1fUiIsMl1d
\[\begin{tikzcd}
	X && {{X}/{R}} \\
	{\funB X} && {\funB {X}/{R}}
	\arrow["{[-]_R}", from=1-1, to=1-3]
	\arrow["\alpha", from=1-1, to=2-1]
	\arrow["{\overline\alpha}", from=1-3, to=2-3]
	\arrow["{\funB [-]_R}"', from=2-1, to=2-3]
\end{tikzcd}\]
\end{lemma}
Moreover, one can phrase the dual notion of subalgebras.
\begin{definition}\label{c2:def:subcoalgebra}
A coalgebra $(X, \alpha)$ is called a subcoalgebra of $(Y, \beta)$, if $X \subseteq Y$ and the canonical inclusion map $i \colon X \subto Y$ is a coalgebra homomorphism.	
\end{definition}
Upon imposing a mild restriction on $\funB$, subcoalgebras carry a lattice structure.
\begin{lemma}[{\cite[Theorem~6.4.]{Rutten:2000:Universal}}]\label{c2:lem:subcoalgebras_lattice}
If $\funB$ preserves weak pullbacks, then the collection of all subcoalgebras of a system $(Y, \beta)$ is a complete lattice. Least upper bounds and greatest lower bounds are respectively given by union and intersection of sets. 
\end{lemma}
Given a set $X \subseteq Y$, we will write $\gen{X}{(Y, \beta)}$ for the least subcoalgebra of $(Y, \beta)$ containing $X$.	 When $(Y, \beta)$ is obvious from the context, we will omit writing it in the subscript.
In the case when $X$ is a singleton or a two-element set, we will lighten up the notation and respectively write $\gen{x}{(Y, \beta)}$ and $\gen{x,y}{(Y, \beta)}$ instead. Least subcoalgebras allow to characterise an important subcategory of coalgebras.
\begin{definition}\label{c2:def:locally_finite}
We call a coalgebra $(X, \alpha)$ locally finite if for all $x \in X$, we have that $\langle x \rangle_{(X, \alpha)}$ is finite.		
\end{definition}
We will write $\coalf{\funB}$ for the full subcategory of $\coa{\funB}$ consisting only of locally finite coalgebras.
\subsection{Deterministic automata}\label{c2:subsec:deterministic_automata}
A deterministic automaton $\mathcal{M}$ with inputs in a finite alphabet $\alphabet$ is a pair $(M, \langle o_M , t_M \rangle)$ consisting of a set of states $M$ and a pair of functions $\langle o_M, t_M \rangle$, where $o_M \colon M \to \{0,1\}$ is the \emph{output} function which determines whether a state $m$ is final ($o_M(m)=1$) or not ($o_M(m)=0$), and $t :M \to M^\alphabet$ is the \emph{transition} function, which, given an input letter $a$ determines the next state. If the set $M$ of states is finite, then we call an automaton $\mathcal{M}$ a deterministic finite automaton (DFA). We will frequently write $m_a$ to denote $t_M(m)(a)$ and refer to $m_a$ as the derivative of $m$ for the input $a$. Definition of derivatives can be inductively extended to words $w \in \alphabet^{\ast}$. We will write $\emptyword$ to denote an empty word. We set $m_{\emptyword} = m$ and $m_{aw'} = (m_a)_{w'}$ for $a \in \alphabet, w' \in \alphabet^\ast$.
\begin{remark}\label{c2:rem:automata_as_coalgebras}
Note that our definition of deterministic automaton slightly differs from the most common one in the literature, by not explicitly including the initial state. Instead of talking about the language of the automaton, we will talk about the languages of particular states of the automaton. 	
\end{remark}


Given a state $m \in M$, we write $L_{\mathcal{M}} (m) \subseteq {\alphabet^{\ast}}$ for its language, which is formally defined by $L_{\mathcal{M}}(m) = \{w \in \alphabet^\ast \mid o(m_w) = 1\}$. 
Given two deterministic automata $(M, \langle o_M, t_M \rangle)$ and $(N, \langle o_N, t_N \rangle)$, a function $h \colon M \to N$ is a homomorphism if it preserves outputs and input derivatives, that is $o_N(h(m))=o_M(m)$ and $h(m)_a = h(m_a)$. The set of all languages $\pset(\alphabet^{\ast})$ over an alphabet $\alphabet$ can be made into a deterministic automaton $(\pset(\alphabet^\ast), \langle o_L, t_L\rangle)$, where for $l \in \pset (\Sigma^{\ast})$ the output function is given by $o_L(l)=[\emptyword \in l]$ and for all $a \in \alphabet$ the input derivative is defined to be $l_a = \{w \mid aw \in l\}$. This automaton is \emph{final}, that is for any other automaton $\mathcal{M} = (M, \langle o_M, t_M \rangle)$ there exists a unique homomorphism from $M$ to $\pset(\alphabet^{\ast})$, which is given by the map $L_{\mathcal{M}} \colon M \to \pset(\alphabet^\ast)$ taking each state $m \in M$ to its language.
\begin{remark}
	Deterministic automata are precisely coalgebras for the functor $\funDFA \colon \Set \to \Set$ given by $\funDFA = \{0,1\} \times (-)^\alphabet \colon \Set \to \Set$. The coalgebraic definition of homomorphism coincides with the definition of an automaton homomorphism stated above. The final coalgebra for that functor corresponds to the final automaton defined on the set $\pset(\alphabet^\ast)$.
\end{remark}
\subsection{Regular expressions}\label{c2:subsec:regular_expressions}
We let $e, f$ range over \emph{regular expressions over $\alphabet$} generated by the following grammar:
$$e , f \in \RExp ::= \zero \mid \one \mid a \in \alphabet \mid e + f \mid e \seq f \mid e^{\ast}$$
The standard interpretation of regular expressions $\sem{-} \colon \RExp \to \pset(\alphabet^\ast)$ is inductively defined by the following equation:
\begin{gather*}
	\sem{\zero} = \emptyset \quad \sem{\one} = \{\emptyword\} \quad \sem{a} = \{ a \} \quad \sem{e + f} =  \sem{e}  \cup \sem{f} \\ \sem{e \seq f}  = \sem{e}  \diamond \sem{f} \quad \sem{e^\ast} = \sem{e}^\ast
\end{gather*}
Given $L, M \subseteq A^\ast$, we define $L \diamond M = \{lm \mid l \in L, m \in M\}$, where mere juxtaposition denotes concatenation of words. $L^\ast$ denotes the \emph{asterate} of the language $L$ defined as $L^\ast = \bigcup_{i \in \N} L^i$ with $L^0 = \{\emptyword\}$ and $L^{n + 1} = L \diamond L^{n}$.
\subsection{Brzozowski derivatives}\label{c2:subsec:brzozowski_derivatives}
Kleene's theorem states that the formal languages accepted by DFA are in one-to-one correspondence with formal languages definable by regular expressions. One direction of this theorem involves constructing a \textsf{DFA} for an arbitrary regular expression. The most common way is via Thompson construction, $\emptyword$-transition removal and determinisation. Instead, we recall a direct construction due to Brzozowski~\cite{Brzozowski:1964:Expressions}, in which the set $\RExp$ of regular expressions is equipped with a structure of deterministic automaton $\mathcal{R} = (\RExp, \langle o_{\mathcal{R}}, t_{\mathcal{R}} \rangle)$ through so-called Brzozowski derivatives~\cite{Brzozowski:1964:Expressions}. The output derivative $o_{\mathcal{R}} \colon \RExp \to \{0, 1\}$ is defined inductively by the following 
\begin{gather*}
    o_{\mathcal{R}}(0) = 0 \quad o_{\mathcal{R}}(1) = 1 \quad o_{\mathcal{R}}(a) = 0 \\ o_{\mathcal{R}}(e + f) = o_{\mathcal{R}}(e) \vee o_{\mathcal{R}}(f) \quad
    o_{\mathcal{R}}(e \seq f) = o_{\mathcal{R}}(e) \wedge o_{\mathcal{R}}(f) \quad o_{\mathcal{R}}(e^{\ast}) = 1
\end{gather*}
for $a \in \alphabet$ and $e,f \in \RExp$. Similarly, the transition derivative $t_{\mathcal{R}} \colon \RExp \to \alphabet \to \RExp$ denoted $t_{\mathcal{R}} (e)(a) = (e)_a$ is defined by
\begin{gather*}
    (\zero)_a = 0 \quad (\one)_a = 0 \quad (a')_a = \begin{cases}
        1 & a = a'\\ 0 & a \neq a'  \end{cases}\\
    (e + f)_a = (e)_a + (f)_a \quad
    (e \seq f)_a = (e_a) \seq f + o_{\mathcal{R}}(e) \seq f \quad (e^{\ast}) = (e)_a \seq e^{\ast}
\end{gather*}
Semantics of regular expressions is well-behaved, that is the standard interpretation $\sem{-}$ assigning a language to each regular expression concides with the canonical language-assigning homomorphism from $\mathcal{R}$ to $\mathcal{L}$.
\begin{lemma}[{\cite[Theorem~3.1.4]{Silva:2010:Kleene}}]\label{c2:lem:adequacy}
    For all $e \in \RExp$, $\sem{e} = L_{\mathcal{R}}(e)$
\end{lemma}
Instead of looking at an infinite-state automaton defined on the state-space of all regular expressions, we can restrict ourselves to the subautomaton $\gen{e}{\mathcal{R}}$ of $\mathcal{R}$ while obtaining the semantics of $e$.
\begin{lemma}\label{c2:lem:adequacy2}
    For all $e \in \RExp$, $\sem{e} = L_{\gen{e}{\mathcal{R}}}(e)$
\end{lemma}
\begin{proof}
    Let $i \colon \gen{e}{\mathcal{R}} \subto \RExp$ be the canonical inclusion homomorphism. Composing it with $L_{\mathcal{R}}$ a unique homomorphism from $\mathcal{R}$ into the final automaton $\mathcal{L}$ yields a homomorphism $L_{\mathcal{R}} \circ i$ from $\gen{e}{\mathcal{R}}$ to the final automaton, which by finality is the same as $L_{\gen{e}{\mathcal{R}}}$. Using \Cref{c2:lem:adequacy} we can show the following: 
    \[
        \sem{e} = L_{\mathcal{R}}(e)=  L_{\mathcal{R}}(i(e)) = L_{\gen{e}{\mathcal{R}}}(e)\qedhere
    \]
\end{proof}
Unfortunately, for an arbitrary regular expression $e \in \RExp$, the automaton $\gen{e}{\mathcal{R}}$ is not guaranteed to have a finite set of states. 
However, simplifying the transition derivatives by quotienting the expressions by associativity, commutativity and idempotence (ACI) guarantees a finite number of reachable states from any expression. Formally speaking, let ${\acirel} \subseteq {\RExp \times \RExp}$ be the least congruence relation closed under
\begin{enumerate}
	\item $ {{(e + f) + g} {~\acirel~} {e + (f+g)}}$ (Associativity)
	\item ${e + f} {~\acirel~} {f + e}$ (Commutativity)
	\item ${e} {~\acirel~} {e + e}$ (Idempotence) 
\end{enumerate}
	 for all $e,f,g \in \RExp$. 
We will write ${\aciq}$ for the quotient of $\RExp$ by the relation $\acirel$ and $[-]_{\acirel} \colon \RExp \to \aciq$ for the canonical map taking each expression $e \in \RExp$ into its equivalence class $[e]_{\acirel}$ modulo $\acirel$. It can be easily verified that $\acirel$ is a bisimulation and hence using \Cref{c2:lem:quotient_coalgebra}, one can equip $\aciq$ with a structure of deterministic automaton $\mathcal{Q} = (\aciq, \langle o_{\mathcal{Q}}, t_{\mathcal{Q}} \rangle)$, where for all $e \in \RExp, a \in \alphabet$, $o_{\mathcal{Q}}([e]_{\acirel})=o_{\mathcal{R}}(e)$ and $([e]_{\acirel})_a = [e_a]_{\acirel}$, which makes the quotient map $[-]_{\acirel} \colon \RExp 
\to \aciq$ into an automaton homomorphism from the Brzozowski automaton $\mathcal{R}$ into $\mathcal{Q}$. This automaton enjoys the following property:
\begin{lemma}[{\cite[Theorem~4.3]{Brzozowski:1964:Expressions}}]\label{c2:lem:locally_finite}
    For any $e \in \RExp$, the set $\gen{e}{\mathcal{Q}} \subseteq \aciq$ is finite.
\end{lemma}
Through an identical line of reasoning to \Cref{c2:lem:adequacy}, we can show that:
\begin{lemma}
	For all $e \in \RExp$, $L_{\gen{[e]_{\acirel}}{\mathcal{Q}}}([e]_{\acirel}) = \sem{e}$
\end{lemma}
\subsection{Pseudometric spaces}\label{c2:subsec:pseudometric_spaces}
A $1$-bounded \emph{pseudometric} on a set $X$ (or equivalently just a \emph{pseudometric}) is a function $d \colon X \times X \to \interval{0}{1}$ satisfying
\begin{enumerate}
	\item  $d(x,x)=0$ (Reflexivity)
	\item  $d(x,y)=d(y,x)$ ({Symmetry})
	\item  $d(x,z) \leq d(x, y) + d(y,z)$ (Triangle inequality)
\end{enumerate}
for all $x,y,z \in X$. If additionally $d(x,y)=0$ implies $x=y$, $d$ is called a ($1$-bounded) \emph{metric}. 
\begin{definition}
	A pseudometric space is a pair $(X, d)$, where $X$ is a set and $d$ is a pseudometric on $X$. We call a function $f \colon X \to Y$ between pseudometric spaces $(X,d_1)$ and $(Y,d_2)$ nonexpansive, if $d_2(f(x),f(y))\leq d_1(x,y)$ for all $x,y \in X$. It is called isometry if it satisfies $d_Y(f(x),f(y))=d_X(x,y)$. 	
\end{definition}
Pseudometrics and nonexpansive functions form a category $\PMet$. This category is bicomplete, i.e. has all limits and colimits~\cite[Theorem~3.8]{Baldan:2018:Coalgebraic}. The categorical product in $\PMet$ is defined as follows:
\begin{definition}
Let $(X,d_1)$ and $(Y, d_2)$ be pseudometrics. We define $(X, d_1) \times (Y, d_2) = (X \times Y, d_{X \times Y})$, where $d_{X \times Y}(\langle x,y \rangle,\langle x',y' \rangle ) = \max \{d_1(x,x'), d_2(y,y')\}$ for all $x,x' \in X$ and $y,y' \in Y$.
\end{definition}
This can be easily extended to any $n$-tuple. We define $0$-tuples to be given by $1_{\bullet} = (\{\bullet\}, d_{\bullet})$, the unique single point pseudometric space, where $d_{\bullet}(\bullet,\bullet)=0$. Given a function of multiple arguments, i.e. $X_1 \to X_2 \to Y$, we will call it nonexpansive, if it is nonexpansive as a function $f \colon (X_1, d_{1}) \times (X_2, d_{2}) \to (Y, d_Y)$. 	


Given a set $X$, we write $D_X$ for the set of all pseudometrics on the set $X$. This set carries a partial order structure, given by
$$d_1 \sqsubseteq d_2 \iff \forall x,y \in X \ldotp d_1(x,y) \leq d_2(x,y)$$  
\begin{lemma}[{\cite[Lemma~3.2]{Baldan:2018:Coalgebraic}}]\label{c2:lem:pseudometrics_complete_lattice}
    $(D_X, \sqsubseteq )$ is a complete lattice. The join of an arbitrary set of pseudometrics $D \subseteq D_X$ is taken pointwise, ie. $\left(\sup D \right)(x,y) = \sup \{ d(x,y) \mid d \in D\}$ for $x, y \in X$. The meet of $D$ is defined to be $\inf D = \sup \{ d \mid d \in D_X , \forall {d' \in D}, d \sqsubseteq d'\}$.
\end{lemma}
The top element of that lattice is given by the discrete pseudometric $\top \colon X \times X \to [0,1]$ such that $\top(x,y) = 0$ if $x=y$, or $\top(x,y)=1$ otherwise.

Crucially for our completeness proof, if we are dealing with descending chains, that is sequences $\{d_i\}_{i \in \N}$, such that $d_i \sqsupseteq d_{i+1}$ for all $i \in \N$, then we can also calculate infima in the pointwise way.
\begin{lemma}\label{c2:lem:chain_pointwise_inf}
    Let $\{d_i\}_{i \in \N}$ be an infinite descending chain in the lattice $(D_X, \sqsubseteq)$ of pseudometrics over some fixed set $X$. Then $(\inf\{d_i \mid i \in \N\})(x,y) = \inf \{d_i(x,y) \mid i \in \N \}$ for any $x,y \in X$.
\end{lemma}
\begin{proof}
    It suffices to argue that $d(x,y) = \inf \{d_i(x,y) \mid i \in \N \}$ is a pseudometric. For reflexivity, observe that $d(x,x) = \inf \{d_i(x,x) \mid i \in \N \} = \inf \{ 0 \} = 0 $ for all $x \in X$. 
    
    For symmetry, we have that $d(x,y) = \inf \{d_i(x,y) \mid i \in \N \} =  \inf \{d_i(y,x) \mid i \in \N \}=d(y,x)$ for any $x, y \in X$. 
    
    The only difficult case is triangle inequality. First, let $i, j \in \N$ and define $k = \max(i,j)$. Since $d_k \sqsubseteq d_i$ and $d_k \sqsubseteq d_j$, we have that $d_k(x,y) + d_k(y,z) \leq d_i(x,y) + d_j(y,z)$.
    Therefore $\inf \{d_l(x,y) + d_l(y,z) \mid l \in \N\}$ is a lower bound of $d_i(x,y) + d_j(y,z)$ for any $i, j \in \N$ and hence it is below the greatest lower bound, that is $\inf \{d_l(x,y) + d_l(y,z) \mid l \in \N\} \leq \inf \{d_i(x,y) + d_j(y,z) \mid i,j \in \N\}$. We can use that property to show that
    \begin{align*}
    	d(x,y) &= \inf \{d_i(z,y) \mid i \in \N\} \\
    	&\leq \inf \{d_i(x,y) + d_i(y,z) \mid i \in \N\}\\
    	&\leq \inf \{d_i(x,y) + d_j(y,z) \mid i,j \in \N\}\\
    	&= \inf \{d_i(x,y) \mid i \in \N\} + \inf \{d_j(y,z) \mid j \in \N\}\\
    	&= d(x,y) + d(y,z)
    \end{align*}
	which completes the proof.
\end{proof}
Additionally, the set of pseudometrics can be equipped with a norm. We write $\eR = [-\infty, \infty]$ for the set of extended reals. For any set $X$, the set of functions $\eR^{X \times X }$, which is a superset of $D_X$, can be seen as a Banach space~\cite{Rudin:1990:Functional} (complete normed vector space) by means of the sup-norm $\|d\| = \sup_{x,y \in X} |d(x,y)|$. This structure will implicitly underly some of the claims used as intermediate steps in the proof of completeness in this and next chapter.
\section{Behavioural distance of deterministic automata}\label{c2:sec:behavioural_distance}
We now focus on defining a behavioural distance for deterministic automata through the abstract framework of coalgebraic behavioural distances~\cite{Baldan:2018:Coalgebraic}. We first recall the main definitions and then concretise the abstract results to the case of our interest.
\subsection{Coalgebraic behavioural distances}\label{c2:subsec:coalgebraic_behavioural_distances}
In order to define a behavioural distance for $\funB$-coalgebras for a functor $\funB \colon \Set \to \Set$, we need to be able to \emph{lift} the functor $\funB$ describing the one-step dynamics of transition systems of interest to the category $\PMet$ of pseudometric spaces and nonexpansive functions. In terms of notation, we will write $\forget \colon \PMet \to \Set$ for the canonical faithful functor taking each pseudometric space $(X, d_X)$ to its underlying set $X$.
\begin{definition}\label{c2:def:lifting}
	Let $\funB \colon \Set \to \Set$ be a functor. We call a functor $\overline{\funB} \colon \PMet \to \PMet$ a lifting of $\funB$ if makes the following diagram commute:
	% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXFBNZXQiXSxbMSwwLCJcXFBNZXQiXSxbMCwxLCJcXFNldCJdLFsxLDEsIlxcU2V0Il0sWzAsMSwiXFxvdmVybGluZXtcXGZ1bkZ9Il0sWzIsMywiXFxmdW5GIl0sWzEsMywiXFxmb3JnZXQiXSxbMCwyLCJcXGZvcmdldCIsMl1d
\[\begin{tikzcd}
	\PMet & \PMet \\
	\Set & \Set
	\arrow["{\overline{\funB}}", from=1-1, to=1-2]
	\arrow["\forget"', from=1-1, to=2-1]
	\arrow["\forget", from=1-2, to=2-2]
	\arrow["\funB", from=2-1, to=2-2]
\end{tikzcd}\]
Given a pseudometric space $(X, d)$, we will write $d^{\funB}$ for the pseudometric $d^{\funB} \colon \funB X \times \funB X \to \interval{0}{1}$ obtained by applying $\overline{\funB}$ to $(X,d)$.
\end{definition}
We can use liftings to equip coalgebras with a notion of behavioural distance, through the following construction:
\begin{lemma}[{\cite[Lemma~6.1]{Baldan:2018:Coalgebraic}}]\label{c2:lem:behavioural_distances}
	Let $\overline{\funB} \colon \PMet \to \PMet$ be a lifting of a functor $\funB \colon \Set \to \Set$ and let $(X, \alpha)$ be a $\funB$-coalgebra. The mapping associating each pseudometric $d \colon X \times X \to [0,\top]$ with $d^{\funB} \circ (\alpha \times \alpha)$ is a monotone mapping on the complete lattice $(D_X, \sqsubseteq)$ of pseudometrics over set $X$. By Knaster-Tarski fixpoint theorem, this mapping has a least fixpoint, that we will refer to as $d_\alpha \colon X \times X \to \interval{0}{1}$. Given a coalgebra $(Y, \beta)$ and a homomorphism $f \colon (X, \alpha) \to (Y, \beta)$, we have that $f \colon (X, d_\alpha) \to (Y, d_\beta)$ is nonexpansive. If $\overline{\funB}$ preserves isometries, then $f$ is an isometry.
\end{lemma}
If $\funB \colon \Set \to \Set$ admits a final coalgebra $(\nu \funB, t)$, then we can define behavioural distance on a  coalgebra $(X, \alpha)$ to be the pseudometric space $\bd_\alpha \colon X\times X \to \interval{0}{1}$ given by $\bd_\alpha(x,y) = d_{t}(\beh{\alpha}(x), \beh{\alpha}(y))$ for all $x, y \in X$. Behavioural distances satisfy several desirable properties:
\begin{lemma}\label{c2:lem:behavioural_distances_properties}
	Let $\overline{\funB} \colon \PMet \to \PMet$ be a lifting of a functor $\funB \colon \Set \to \Set$ that admits a final coalgebra $(\nu \funB, t)$. Given a coalgebra $(X, \alpha)$ and $x,y \in X$, the following facts hold:
	\begin{enumerate}
		\item $x \beheq y \implies \bd_\alpha(x,y)=0$
		\item If $\overline\funB$ preserves metrics and $\funB$ is finitary, then $\bd_\alpha(x,y)=0 \implies x \beheq y$
		\item If $\overline{\funB}$ preserves isometries, then $d_\alpha(x,y) = \bd(x,y)$
	\end{enumerate}
\end{lemma}
\begin{proof}
	\circlednum{1} follows from \cite[Lemma~6.6]{Baldan:2018:Coalgebraic}. For \circlednum{2}, we have that if $\funB$ is finitary, then $(\nu \funB,t)$ can be obtained via the Adamek fixpoint theorem~\cite{Adamek:1995:Greatest} and hence one can apply \cite[Theorem~6.10]{Baldan:2018:Coalgebraic}. Finally, \circlednum{3} follows from \cite[Theorem~6.7]{Baldan:2018:Coalgebraic}.
\end{proof}
\subsection{Behavioural distance of deterministic automata via functor lifting}	
It turns out that shortest-distinguishing-word metric (\Cref{c2:eq:shortest_distinguishing_word}) can be obtained as an instance of the coalgebraic framework of behavioural distances~\cite[Example~6.5]{Baldan:2018:Coalgebraic} using an appropriate lifting of the functor $\funDFA = \{0,1\} \times (-)^\alphabet$ describing one-step behaviour of finite automata~\cite[Example~6.3]{Baldan:2018:Coalgebraic}. That lifting is defined as follows; let $d \colon M \times M \to [0,1]$ be a pseudometric and let $\lambda \in \interval[open]{0}{1}$ be a fixed \emph{discount factor}. We can equip the set $\funDFA X$ with a distance function given by
\[
	d^{\funDFA}(\langle o_1, g_1 \rangle, \langle o_2, g_2 \rangle) = \max\{d_{\{0,1\}}(o_1, o_2), \lambda \cdot \max_{a \in \alphabet} d(g_1(a), g_2(a))\} 
\]   
for all $\langle o_1, g_1 \rangle, \langle o_2, g_2 \rangle \in \funDFA X$. The definition above involves $d_{\{0,1\}}$, the discrete metric on the set $\{0,1\}$. Intuitively, two one-step behaviours $\langle o_1, g_1\rangle, \langle o_2, g_2 \rangle \in \{0,1\} \times M^\alphabet$ of a deterministic automaton with the set of states $M$ are maximally apart if $o_1 \neq o_2$, that is, they disagree in their output behaviour. Otherwise, the distance is equal to a maximal distance $d(g_1(a), g_2(a))$ between reachable states for all letters $a \in \alphabet$ of the alphabet, discounted by the factor of $\lambda$.

The lifting defined above is particularly well-behaved, as it satisfies the following:

\begin{proposition}
	$d^{\funDFA}$ preserves isometries and metrics.
\end{proposition}
\begin{proof}
	Preservation of isometries follows from \cite[Theorem 5.23]{Baldan:2018:Coalgebraic} and preservation of metrics follows from~\cite[Theorem~5.24]{Baldan:2018:Coalgebraic}.
\end{proof}
Combining the statement above with \Cref{c2:lem:behavioural_distances} yields that for any deterministic automaton $\mathcal{M} := (M, \langle o_M, t_M \rangle)$, its behavioural distance $\bd_{\langle o_M, t_M \rangle}$ is a pseudometric space, whose values can be calculated as the least fixpoint of the monotone map $\Phi_{\langle o_M, t_M\rangle} \colon D_M \to D_M$ defined as
$$
\Phi_{\langle o_M, t_M\rangle}(m_1, m_2) = d^{\funDFA}(\langle o_M(m_1), t_{M}(m_1) \rangle, \langle o_M(m_2), t_{M}(m_2) \rangle)
$$
for all $m_1, m_2 \in M$.

Moreover, because of the preservation of metrics and \Cref{c2:lem:behavioural_distances_properties}, we know that for the final deterministic automaton $\mathcal{L} = (\pset (\alphabet^\ast), \langle o_L, t_L\rangle)$, the least fixpoint of $\Phi_{\langle o_L, t_L\rangle}$ is a metric space. This metric enjoys the following concrete characterisation:
\begin{proposition}[{\cite[Example~6.5]{Baldan:2018:Coalgebraic}}]
	For the final deterministic automaton $\mathcal{L} = (\pset (\alphabet^\ast), \langle o_L, t_L\rangle)$, the least fixpoint of $\Phi_{\langle o_L, t_L\rangle}$ coincides with shortest-distinguishing-word metric.
\end{proposition}

\section{Quantitative Axiomatisation}\label{c2:sec:quantitative_axiomatisation}
In order to provide a quantitative inference system for reasoning about the behavioural distance of languages denoted by regular expressions, we first recall the definition of quantitative equational theories from the existing literature~\cite{Mardare:2016:Quantitative,Bacci:2018:Bisimilarity} following the notational conventions from~\cite{Bacci:2018:Bisimilarity}. We then present our axiomatisation and demonstrate its soundness. The interesting thing about our axiomatisation is the lack of any fixpoint introduction rule. We show that in the case of quantitative analogue of equational logic~\cite{Mardare:2016:Quantitative} containing the infinitary rule capturing the notion of convergence, we can use our axioms to derive Salomaa's fixpoint rule from his axiomatisation of language equivalence of regular expressions~\cite{Salomaa:1966:Two}.

\subsection{Quantitative equational theories}\label{c2:subsec:quantitative_equational_theories} 
Let $\Sigma$ be an algebraic signature (in the sense of universal algebra~\cite{Burris:1981:Course}) consisting of operation symbols $f_n \in \Sigma$ of arity $n \in \N$. If we write $X$ for the countable set of \emph{metavariables}, then $\TT[\Sigma]{X}$ denotes a set of freely generated terms over $X$ built from the signature $\Sigma$. As a notational convention, we will use letters $t,s,u, \ldots \in \TT[\Sigma]{X}$ to denote terms. 
By a \emph{substitution} we mean a function of the type $\sigma\colon X \to \TT[\Sigma]{X}$ allowing to replace metavariables with terms. Each substitution can be inductively extended to terms in a unique way by setting $\sigma(f(t_1, \dots, t_n)) = f(\sigma(t_1), \dots, \sigma(t_n))$ for each operation symbol $f_n \in \Sigma$ from the signature. We will write $\Sub[\Sigma]$ for the set of all substitutions. Given two terms $t,s \in \TT[\Sigma]{X}$ and a nonnegative rational number $\e \in \Q$ denoting the distance between the terms, we call $t \equiv_\e s$ a \emph{quantitative equation (of type $\Sigma$)}. Notation-wise, we will write $\E[\Sigma]$ to denote the set of all quantitative equations (of type $\Sigma$) and we will use the capital Greek letters $\Gamma, \Theta, \ldots \subseteq \E[\Sigma]$ to denote the subsets of $\E[\Sigma]$. By a \emph{deducibility relation} we mean a binary relation denoted  ${\vdash} \subseteq \pset ({\E[\Sigma]}) \times \E[\Sigma]$.  Similarly, to the classical equational logic, we will use the following notational shorthands:
\begin{gather*} 
	\Gamma \vdash t \equiv_\e s \iff (\Gamma,t \equiv_\e s) \in {\vdash} \qquad \text{ and } \qquad \vdash t \equiv_\e s \iff \emptyset \vdash t \equiv_\e s
\end{gather*}
Furthermore, following the usual notational conventions, we will write $\Gamma \vdash \Theta$ as a shorthand for the situation when $\Gamma \vdash t \equiv_\e s$ holds for all $t \equiv_\e s \in \Theta$. To call $\vdash$ a \emph{quantitative deduction 
system (of type $\Sigma$)} it needs to satisfy the following rules of inference: 
\begin{align*} 
(\Top) \quad 
& \vdash t \equiv_1 t \,, \\
(\Refl) \quad 
& \vdash t \equiv_0 t \,, \\
(\Symm) \quad 
& \{t\equiv_\e s\} \vdash s\equiv_\e t \,, \\
(\Triang) \quad 
& \{t \equiv_\e u, u \equiv_{\e'} s \} \vdash t \equiv_{\e+\e'} s \,, \\
(\Max) \quad 
& \{t\equiv_\e s\} \vdash t\equiv_{\e+\e'}s \,, \text{ for all $\e'>0$} \,, \\ 
(\Cont) \quad 
& \{t\equiv_{\e'}s\mid \e'>\e\} \vdash t\equiv_\e s \,, \\
(\Nexp) \quad
& \{t_1\equiv_\e s_1,\ldots,t_n \equiv_\e s_n\} \vdash f(t_1,\dots, t_n) \equiv_\e f(s_1,\dots, s_n) \,, 
\text{ for all $f_n \in \Sigma$} \,, \\
(\Subst) \quad
& \text{If $\Gamma \vdash t \equiv_\e s$, then $\sigma(\Gamma) \vdash \sigma(t) \equiv_\e \sigma(s)$, 
for all $\sigma \in \Sub[\Sigma]$} \,, \\
(\Cut) \quad 
& \text{If $\Gamma \vdash \Theta$ and $\Theta \vdash t \equiv_\e s$, then $\Gamma \vdash t \equiv_\e s$} \,, \\
(\Assum) \quad
& \text{If $t \equiv_\e s \in\Gamma$, then $\Gamma \vdash t \equiv_\e s$} \,.
\end{align*}
where $\sigma(\Gamma) = \set{\sigma(t) \equiv_\e \sigma(s)}{ t \equiv_\e s \in \Gamma}$.
Finally, by a \emph{quantitative equational theory} we mean a set $\U$ of universally quantified \emph{quantitative inferences} 
$
\{t_1 \equiv_{\e_1} s_1, \dots, t_n \equiv_{\e_n} s_n\} \vdash t \equiv_\e s \,,
$ with \emph{finitely many premises}, closed under $\vdash$-derivability.

\subsection{Quantitative algebras}\label{s2:subsec:quantitative_algebras} 

Quantitative equational theories lie on the syntactic part of the picture. On the semantic side, we have their models called \emph{quantitative algebras}, defined as follows. 

\begin{definition}[{\cite[Definition~3.1]{Mardare:2016:Quantitative}}]
    A quantitative algebra is a tuple $\qalgA = (A, \Sigma^{\qalgA}, d^{\qalgA})$, such that $(A, \Sigma^{\qalgA})$ is an algebra for the signature $\Sigma$ and $(A, d^{\qalgA})$ is a pseudometric such that for all operation symbols $f_n \in \Sigma$, for all $1 \leq i \leq n$, $a_i, b_i \in \alphabet$, $d^{\qalgA}(a_i,b_i)\leq \e$ implies $d^{\qalgA}(f^{\qalgA}(a_1, \dots, a_n), f^{\qalgA}(b_1, \dots, b_n)) \leq \e$.
\end{definition}

Consider a quantitative algebra $\qalgA = (A,\Sigma^\qalgA,d^\qalgA)$. Given an assignment  $\iota \colon X \to A$ of meta-variables from $X$ to elements of carrier $A$, one can inductively extend it to $\Sigma$-terms $t \in \TT[\Sigma]{X}$ in a unique way. We will abuse the notation and just write $\iota(t)$ for the interpretation of the term $t$ in quantitative algebra $\qalgA$. We will say that $\qalgA$ \emph{satisfies} the quantitative inference $\Gamma \vdash t \equiv_\e s$, written $\Gamma \models_\qalgA t \equiv_\e s$, if for any assignment of the meta-variables $\iota \colon X \to A$ it is the case that for all $t' \equiv_{\e'} s' \in \Gamma$ we have that $d^\qalgA(\iota(t'),\iota(s')) \leq \e'$ implies $d^\qalgA(\iota(t),\iota(s)) \leq \e $. Finally, we say that a quantitative algebra $\qalgA$ \emph{satisfies} (or is a \emph{model} of) the quantitative theory $\U[]$, 
if whenever $\Gamma \vdash t \equiv_\e s \in \U[]$, then $\Gamma \models_\qalgA t \equiv_\e s$. 

\subsection{Quantitative algebra of regular expressions}\label{c2:subsec:quantitative_algebra_of_regular_expressions}

From now on, let's focus on the signature $\Sigma^{\qalgB} = \{\zero_0, \one_0, +_2, \seq_2, {(-)^\ast}_1\} \cup \{a_0 \mid a \in \alphabet\}$, where $\alphabet$ is a finite alphabet. This signature consists of all operations of regular expressions. We can easily interpret all those operations in the set $\RExp$ of all regular expressions, using trivial interpretation functions eg. $+^{\qalgB}(e,f) = e + f$, which interpret the operations by simply constructing the appropriate terms. Formally speaking, we can do this because the set $\RExp$ is the carrier of initial algebra~\cite{Burris:1981:Course} (free algebra over the empty set of generators) for the signature $\Sigma$. 

To make this algebra into a quantitative algebra, we first equip the set $\RExp$ with a pseudometric, given by 
\begin{equation}\label{c2:eq:qalg_dist}
	d^{\qalgB}(e,f) = \langmetric(\sem{e}, \sem{f}) \qquad \text{ for all } e, f \in \RExp
\end{equation}

Recall that $\langmetric$ used in the definition above is a behavioural pseudometric on the final deterministic automaton carried by the set $\pset (\alphabet^{\ast})$ of all formal languages over an alphabet $\alphabet$. In other words, we define the distance between arbitrary expressions $e$ and $f$ to be the distance between formal languages $\sem{e}$ and $\sem{f}$ calculated through the shortest-distinguishing-word metric. 
It turns out, that in such a situation all the interpretation functions of $\Sigma$-algebra structure on $\RExp$ are nonexpansive with respect to the pseudometric defined above. In other words, we have that: 

\begin{lemma}\label{c2:lem:quantitative_algebra}
    $\qalgB = (\RExp, \Sigma^{\qalgB}, d^{\qalgB})$ is a quantitative algebra.
\end{lemma}
\begin{proof}
Since $\langmetric$ is a pseudometric, then so is $d^{\qalgB} = \langmetric \circ (\sem{-}\times\sem{-})$. We now verify the nonexpansivity of interpretations of operations with non-zero arity. Let $e,f,g,h \in \RExp$, $d^{\qalgB}(e,g) \leq \e$ and $d^{\qalgB}(f,h) \leq \e$. 

\begin{enumerate}
    \item We show that $d^{\qalgB}(e + f, g + h) \leq \e$. In the case when $\e = 0$, the proof simplifies to showing that if $\sem{e} = \sem{g}$ and $\sem{f} = \sem{h}$ then $\sem{e + g} = \sem{g + h}$, which holds immediately. 
    For the remaining case, when $\e > 0$, let $n = \lceil \log_{\lambda} \e \rceil$. 
    
    Observe that in such a case, we have that $d^{\qalgB}(e,g) \leq \lambda^n$ and $d^{\qalgB}(f,h) \leq \lambda^n$. Using it, we can deduce that $\sem{e}$ and $\sem{g}$ (and similarly $\sem{f}$ and $\sem{h}$) agree on all words of length strictly below $n$ (because the shortest word for which they disagree is at least of length $n$). To put that formally:
    $$\forall w \in \alphabet^{\ast} \ldotp |w| < n \implies \left(w \in \sem{e} \iff w \in \sem{g} \right) \wedge  \left(w \in \sem{f} \iff w \in \sem{h} \right) $$
    Let $w \in \alphabet^\ast$, such that $|w|<n$. We have that 
    \begin{align*}
        w \in \sem{e + f} &\iff w \in \sem{e} \cup \sem{f} \iff \left(w \in \sem {e}\right) \vee \left(w \in \sem{f}\right) \\
        &\iff \left(w \in \sem{g}\right) \vee \left(w \in \sem{h}\right) \tag{$|w| < n$} \\
        &\iff w \in \sem{g + h}
    \end{align*}
    And thus $\sem{e + f}$ and $\sem{g + h}$ agree on all words of the length below $n$ and therefore $d^{\qalgB}(e + f, g + h) \leq \lambda^{n} \leq \e$.
    
    \item The case for $\e = 0$ holds immediately through the same line of reasoning as before, relying on well-definedness of $\diamond$ (concatenation) operation on formal languages. We focus on the remaining case, making the same simplification as before, that is we assume that $\sem{e}$ and $\sem{g}$ (as well as $\sem{f}$ and $\sem{h}$) agree on all word of length strictly below $n$). We show that $\sem{e \seq f}$ and $\sem{g \seq h}$ also agree on all words of the length strictly less than $n$. Let $w \in \alphabet^{\ast}$, such that $|w|<n$. We have that: 
    \begin{align*}
        w \in \sem{e \seq f} &\iff w \in \sem{e} \diamond \sem{f}\\ &\iff
        \left(\exists u,v \in \alphabet^\ast \ldotp w=uv \wedge w \in \sem{e} \wedge v \in \sem{f}\right)\\
        &\iff  \left(\exists u,v \in \alphabet^\ast \ldotp w=uv \wedge w \in \sem{g} \wedge v \in \sem{h}\right) \tag{ $|u|< n$ and $|v| < n$} \\
        &\iff w \in \sem{g} \diamond \sem{h} \iff w \in \sem {g \seq h}
    \end{align*}
    \item We use the same line of reasoning as before. Assume that $\sem{e}$ and $\sem{g}$ agree on all words of length below $n$. Let $w \in \alphabet^\ast$, such that $|w| < n$. We have the following:
    \begin{align*}
        w \in \sem{e^\ast} &\iff w \in \sem{e}^\ast\\ 
        &\iff w = \emptyword \vee \left(\exists k \geq 1 \ldotp \exists u_1, \dots, u_k \in \alphabet^\ast \ldotp w = u_1\dots u_k \right.\\&\left. \qquad\qquad\wedge u_1 \in \sem{e} \wedge \dots \wedge u_k \in \sem{e}\right) \\
        &\iff w = \emptyword \vee \left(\exists k \geq 1 \ldotp \exists u_1, \dots, u_k \in \alphabet^\ast\ldotp w = u_1\dots u_k \right.\\&\left. \qquad\qquad\wedge u_1 \in \sem{g} \wedge \dots \wedge u_k \in \sem{g}\right) \tag{$|u_1| < n, \dots, |u_k| < n$ }\\
        &\iff w \in \sem{g}^\ast \iff w \in \sem{g^*}\qedhere
    \end{align*}
\end{enumerate}
\end{proof}
In order to talk about the quantitative algebra $\qalgB$ of the behavioural distance of regular expressions in an axiomatic way, we introduce the quantitative equational theory \textsf{REG} (\Cref{c2:fig:axioms}).

\begin{figure}[h]
	
{
\small
\begin{tabular}{l@{\quad}l}
\(
\begin{array}{ll}
&\textbf{Nondeterministic choice}\\
(\mathsf{SL1})\;\; 
& \vdash e + e \equiv_0 e \,, \\
(\mathsf{SL2})\;\; 
& \vdash e + f \equiv_0 f + e \,, \\
(\mathsf{SL3})\;\; 
& \vdash (e + f) + g\equiv_0 e + (f + g) \,, \\
(\mathsf{SL4})\;\; 
& \vdash e + \zero\equiv_0 e \,, \\
(\mathsf{SL5})\;\; & \{ e \equiv_\e g , f \equiv_{\e'} h\} \\ & \quad\vdash e + f \equiv_{\max(\e, \e')} g + h \,, \\\\\\
%% recursion
&\textbf{Loops} \\
(\mathsf{Unroll})\;\; & \vdash e^\ast \equiv_0 e \seq e^{\ast} + \one \,, \\
(\mathsf{Tight})\;\; & \vdash (e + \one)^\ast \equiv_0 e^\ast \,, \\[1.2ex]
%%(\Fix)\;\; & \{ s \equiv_0 t[s / X] \} \vdash s \equiv_0 \rec{X}{t} \,, \text{ for $X$ guarded in $t$} \,, \\
%% distance
\end{array}
\)&
\(
\begin{array}{ll}
&\textbf{Sequential composition}\\
	(\mathsf{1S})\;\; 
& \vdash \one \seq e \equiv_0 e \,, \\
(\mathsf{S})\;\; 
& \vdash e \seq (f \seq g) \equiv_0 (e \seq f) \seq g \,, \\
(\mathsf{S1})\;\; 
& \vdash e \seq \one \equiv_0 e \,, \\
(\mathsf{0S})\;\; 
& \vdash \zero \seq e \equiv_0 \zero \,, \\
(\mathsf{S0})\;\; 
& \vdash e \seq \zero \equiv_0 \zero \,, \\
(\mathsf{D1})\;\; 
& \vdash e \seq (f + g) \equiv_0 e \seq f + e \seq g \,, \\
(\mathsf{D2})\;\; 
& \vdash (e + f) \seq g \equiv_0 e \seq g + f \seq g \,, \\\\
&\textbf{Behavioural pseudometric}\\
(\dPref)\;\; & \{ e \equiv_\e f \} \vdash a \seq e \equiv_{\e'} a \seq f \,,\\&\qquad \text{for $\e'\geq \lambda \cdot \e$} \\[1.2ex]
\end{array}
\)
\end{tabular}
}	
\caption{Axioms of the quantitative equational theory \textsf{REG} for $e,f,g \in \RExp$ and $a \in \alphabet$.}
\label{c2:fig:axioms}
\end{figure}

The first group of axioms capture properties of the nondeterministic choice operator $+$ \textsf{(SL1-SL5)}. The first four axioms \textsf{(SL1-SL4)} are the usual laws of semilattices with bottom element $\zero$. (\textsf{SL5}) is a quantitative axiom allowing one to reason about distances between sums of expressions in terms of distances between expressions being summed. Moreover, \textsf{(SL1-SL5)} are axioms of so-called \emph{Quantitative Semilattices with zero}, which have been shown to axiomatise the Hausdorff metric~\cite{Mardare:2016:Quantitative}. 

The sequencing axioms \textsf{(1S), (S1), (S)} state that the set $\RExp$ of regular expressions has the structure of a monoid (with neutral element $\one$) with absorbent element $0$ \textsf{(0S), (S0)}. Additionally, \textsf{(D1-D2)} talk about interaction of the nondeterministic choice operator $+$ with sequential composition. 

The loop axioms \textsf{(Unroll)} and \textsf{(Tight)} are directly inherited from Salomaa's axiomatisation of language equivalence of regular expressions~\cite{Salomaa:1966:Two}. \textsf{(Unroll)} axiom associates loops with their intuitive behaviour of choosing, at each step, between successful termination and executing the loop body once. \textsf{(Tight)} states that the loop whose body might instantly terminate, causing the next loop iteration to be executed immediately is provably equivalent to a different loop, whose body does not contain immediate termination. 
%Contrary to Salomaa~\cite{Salomaa:1966:Two} and Kozen~\cite{Kozen:1994:Completeness} we do not include any fixpoint rule allowing the introduction of loops. We will elaborate on this in the next section, showing that in the presence of infinitary \textsf{(Cont)} rule of the quantitative deduction systems, Salomaa's rule for introducing loops is derivable from other axioms of \textsf{REG}. 
Finally, \textsf{(\dPref)} captures the fact that prepending the same letter to arbitrary expressions shrinks the distance between them by the factor of $\lambda \in \interval[open]{0}{1}$ (used in the definition of $d^{\qalgB}$). This axiom is adapted from the axiomatisation of discounted probabilistic bisimilarity distance~\cite{Bacci:2018:Bisimilarity}.
Through a simple induction on the length of derivation, one can verify that indeed $\qalgB$ is a model of the quantitative theory \textsf{REG}. 
\begin{theorem}[Soundness]\label{c2:thm:soundness}
    The quantitative algebra $\qalgB = (\RExp, \Sigma^{\qalgB}, d^\qalgB)$ is a model of the quantitative theory $\mathsf{REG}$. In other words, for any $e, f \in \RExp$ and $\e \in \Q$, if $\Gamma \vdash e \equiv_\e f \in \mathsf{REG}$, then $\Gamma \models_\qalgB e \equiv_\e f$
\end{theorem}
\begin{proof}
By the structural induction on the judgement $\Gamma \vdash e \equiv_{\e} f \in \mathsf{REG}$. $(\Subst)$, $(\Cut)$ and $(\Assum)$ deduction rules from classical logic hold immediately. The soundness of $(\Top)$, $(\Refl)$, $(\Symm)$, $(\Triang)$, $(\Cont)$ and $(\Max)$ follows from the fact that $d^{\qalgB}$ is a pseudometric. $(\Nexp)$ follows from the fact that interpretations of symbols from the algebraic signature are nonexpansive (\cref{c2:lem:quantitative_algebra}). Recall that $d^{\qalgB} = \langmetric \circ (\sem{-} \times \sem {-})$. 

 Additionally, for all axioms in the form $\vdash e \equiv_0 f$ it suffices to show that $\sem{e} = \sem{f}$. \textsf{(SL1-SL4)}, \textsf{(1S)}, \textsf{(S)}, \textsf{(S1)}, \textsf{(0S)}, \textsf{(S0)}, \textsf{(D1-D2)}, \textsf{(Unroll)} and \textsf{(Tight)} are taken from Salomaa's axiomatisation of language equivalence of regular expressions~\cite{Salomaa:1966:Two} and thus both sides of those equations denote the same formal languages~\cite[Theorem~5.2]{Wagemaker:2019:Completeness}. For $(\dPref)$ assume that the premise is satisfied in the model, that is $\langmetric(\sem{e},\sem{f}) \leq \e$. Let $\e' \geq \lambda \cdot \e$. We show the following:
\begin{align*}
    d^{\qalgB}(a \seq e, a \seq f) &= \langmetric(\sem{a \seq e}, \sem{a \seq f}) \tag{\Cref{c2:eq:qalg_dist}}\\
    & = \Phi_{\langle o_L, t_L \rangle}(\langmetric)(\sem{a \seq e}, \sem{a \seq f}) \tag{$\langmetric$ is a fixpoint of $\Phi_{\langle o_L, t_L \rangle}$}\\
    &= \max\{d_{\{0,1\}}(o_L(a \seq e), o_L(a \seq e')) \lambda \cdot \max_{a' \in \alphabet}  \langmetric(\sem{a \seq e}_{a'}, \sem{a \seq f}_{a'} )\}\\
    &= \lambda \cdot \langmetric(\sem{e}, \sem{f}) \tag{Def. of final automaton} \\
    & \leq \lambda \cdot \e \leq \e' \\
\end{align*}
Finally, \textsf{(SL5)} is derivable from other axioms; we included \textsf{(SL5)} as an axiom to highlight the similarity of our inference system with axiomatisations of language equivalence of regular expressions~\cite{Salomaa:1966:Two,Kozen:1994:Completeness} containing the axioms of semilattices with bottom. In the previous work~\cite{Mardare:2016:Quantitative}, \textsf{(SL1-SL5)} are precisely the axioms of \emph{quantitative semilattices with zero} axiomatising the Hausdorff distance.  If $\e = \max(\e, \e')$ then $\{e \equiv_\e g \} \vdash e \equiv_{\max(\e, \e')} g$ holds by $(\Assum)$. If $\e < \max(\e, \e')$, then we can derive the quantitative judgement above using $(\Max)$. By a similar line of reasoning, we can show that $\{f \equiv_{\e'} h \} \vdash f \equiv_{\max(\e, \e')} h$. Finally, using $(\Cut)$ and $(\Nexp)$, we can show that $\{e \equiv_{\e} g, f \equiv_{\e'} h\} \vdash e + f \equiv_{\max(\e,\e')} g + h$ as desired.
\end{proof}
We now revisit the example from \Cref{c2:fig:dfas}. Recall that states marked as initial of the left and middle automata can be respectively represented as $a^\ast$ and $a + \one$. The shortest word distinguishing languages representing those expressions is $aa$. If we fix $\lambda = \frac{1}{2}$, then $d^{\qalgB}(a^\ast, a + \one)= \langmetric(\sem{a^\ast}, \sem{a+ \one}) = \frac{1}{4}=\left(\frac{1}{2}\right)^{|aa|}$. We can derive this distance through the means of axiomatic reasoning using the quantitative equational theory \textsf{REG} in the following way: 
\begin{example}
 	\begin{align*}
		\vdash a^* &\equiv_1 \zero \tag{$\Top$} \\
		\vdash a \seq a^{\ast} &\equiv_{\frac{1}{2}} a \seq \zero\tag{$\dPref$}\\
		\vdash a \seq a^\ast + 1&\equiv_{\frac{1}{2}} a \seq \zero + \one  \tag{$\vdash \one \equiv_0 \one$ and \textsf{SL5}}\\
		\vdash a^{\ast} &\equiv_{\frac{1}{2}} \one \tag{$\Triang$, \textsf{Unroll}, \textsf{S0} and \textsf{SL4}}\\
		\vdash a \seq a^\ast &\equiv_{\frac{1}{4}} a \seq 1 \tag{$\dPref$}\\
		\vdash a \seq a^\ast + 1 &\equiv_{\frac{1}{4}} a \seq \one + \one  \tag{$\vdash \one \equiv_0 \one$ and \textsf{SL5}}\\
		\vdash a^\ast &\equiv_{\frac{1}{4}} a + \one \tag{$\Triang$, \textsf{Unroll} and \textsf{S1}}\\
	\end{align*}
\end{example}
\subsection{The lack of the fixpoint axiom}\label{c2:subsec:fixpoint_axiom}

 Traditionally, completeness of inference systems for behavioural equivalence of languages of expressions featuring recursive constructs such as Kleene star or $\mu$-recursion~\cite{Milner:1984:Complete} rely crucially on fixpoint introduction rules. Those allow showing that an expression is provably equivalent to a looping construct if it exhibits some form of self-similarity, typically subject to productivity constraints. As an illustration, Salomaa's axiomatisation of language equivalence of regular expressions incorporates the following inference rule:
\begin{equation}\label{c2:eq:salomaa}
	\inferrule{g \equiv e \seq g + f \qquad \emptyword \notin \sem{e}}{g \equiv e^\ast \seq f}
\end{equation}
The side condition on the right states that the loop body is \emph{productive}, that is a deterministic automaton corresponding to an expression $e$ cannot immediately reach acceptance without performing any transitions. This is simply equivalent to the language $\sem{e}$ not containing the empty word. It would be reasonable for one to expect \textsf{REG} to contain a similar rule to be complete, especially since it should be able to prove language equivalence of regular expressions (by proving that they are in distance zero from each other). Furthermore, all axioms of Salomaa except \Cref{c2:eq:salomaa} are contained in \textsf{REG} as rules for distance zero.

It turns out that in the presence of the infinitary continuity $(\Cont)$ rule of quantitative deduction systems and the $(\dPref)$ rule of \textsf{REG}, the Salomaa's inference rule (\Cref{c2:eq:salomaa}) becomes a derivable fact for distance zero. First of all, one can show that $(\dPref)$ can be generalised from prepending single letters to prepending any regular expression satisfying the side condition from \Cref{c2:eq:salomaa}.

\begin{lemma}\label{c2:lem:generalised_pref}
	Let $e,f,g \in \RExp$, such that $\emptyword \notin \sem{e}$. Then, 	$
		 \{ f \equiv_\e g \} \vdash e \seq f \equiv_{\e'} e \seq g 
	$ is derivable  using the axioms of \textsf{REG}
 for all $\e'\geq \lambda \cdot \e$.
\end{lemma}
\begin{proof}
	By induction on $e \in \RExp$. The cases when $e = \one$ and $e = (e_1)^\ast$ are not possible, because of the assumption that $\emptyword \notin \sem{e}$. 
	
	\fbox{$e = \zero$} 
	Because of the \textsf{(0S)} axiom, we can derive that $e \seq f \equiv_0 \zero \equiv_0 \zero \seq g \equiv_0 e \seq g$. We can show the desired conclusion, using $(\Max)$ axiom.
	
	\fbox{$e = a$} Holds immediately, because of $(\dPref)$ axiom.
	
	\fbox{$e = e_1 + e_2$} Because of the assumption, both $ \emptyword \notin \sem{e_1}$ and $ \emptyword \notin \sem{e_2}$. Using the induction hypothesis, we can derive that $\vdash e_1 \seq f \equiv_{\e'} e_1 \seq g$ and $e_2 \seq f \equiv_{\e'} e_2 \seq g$. We can apply the \textsf{(SL5)} axiom to derive that $\vdash e_1 \seq f + e_2 \seq f \equiv_{\e'} e_1 \seq g + s_2 \seq g$. Finally, we can apply the \textsf{(D2)} axiom to both sides through \textsf{(Triang)} and derive $\vdash (e_1 + e_2) \seq f \equiv_{\e'} (e_1 + e_2) \seq g$ as desired.
	
	\fbox{$e = e_1 \seq e_2$} Because of the assumption, $\emptyword \notin \sem{e_1}$ or $\emptyword \notin \sem{e_2}$. First, let's consider the subcase when both $\emptyword \notin \sem{e_1}$ and $\emptyword \notin \sem{e_2}$. By induction hypothesis, we have that $\vdash e_2 \seq f \equiv_{\e'} e_2 \seq g$. Since $\lambda \in \interval[open]{0}{1}$, we have that $\lambda \cdot \e' < \e'$. Because of that, we can apply induction hypothesis again and obtain $\vdash  e_1 \seq e_2 \seq f \equiv_{\e'} e_1 \seq e_2 \seq g$. Now, let's consider the subcase when $\emptyword \notin \sem{e_1}$, but $\emptyword \in \sem{e_2}$. Using $(\Nexp)$, we can obtain $\vdash e_2 \seq f \equiv_{\e} e_2 \seq g $. Then, since $\emptyword \notin \sem{e_1}$, we can apply the induction hypothesis and obtain $\vdash e_1 \seq e_2 \seq f \equiv_{\e'} e_1 \seq e_2 \seq g$ as desired. The remaining subcase, when  $\emptyword \notin \sem{e_2}$ but $\emptyword \in \sem{e_1}$ is symmetric and therefore omitted. \qedhere 
\end{proof}

With the above lemma in hand, one can inductively show that if $g \equiv_0 e \seq g + f$ and $\emptyword \notin \sem{e}$, then $g$ gets arbitrarily close to $e^\ast \seq f$. Intuitively, the more we unroll the loop in $e^\ast \seq f$ using \textsf{(Unroll)} and the more we unroll the definition of $g$, then the closer both expressions become.
\begin{lemma}\label{c2:lem:star_lemma}
Let $e,f,g \in \RExp$, such that $\emptyword \notin \sem{e}$ and let $n \in \N$. Then, $ \{g \equiv_0 e \seq g  + f\} \vdash g \equiv_{\e} e^{\ast} \seq f$ is derivable using the axioms of $\mathsf{REG}$ for all $\e \geq \lambda^n $.
\end{lemma}
\begin{proof}
	By induction. If $n = 0$, then using $(\Top)$, we can immediately conclude that $\vdash g \equiv_1 e^{\ast} \seq f$. Since by the assumption $\e \geq \lambda^0 = 1$, we can apply $(\Max)$ and obtain $\vdash g \equiv_{\e} e^\ast \seq f $. 
	
	For the inductive cases, we have that $\e \geq \lambda^{n+1}$ and hence $\e \cdot \lambda^{-1} \geq \lambda^n $. We cannot instantly apply the induction hypothesis, as $\e \cdot \lambda^{-1}$ is not guaranteed to be rational. Instead, we will use $(\Cont)$ of quantitative deduction systems. Let $\e'$ be an arbitrary rational number strictly greater than $\e$ and let $\{r_n\}_{n \in \N}$ be any decreasing sequence of rationals that converges to $\lambda^{-1}$. Pick element $r_N$ of that sequence that satisfies that $\e' \geq \e \cdot \lambda \cdot r_N$. We can always pick such an element, as $\{r_n\}_{n \in \N}$ gets arbitrarily close to $\lambda^{-1}$, so $\{\lambda \cdot r_n\}_{n \in \N}$ is a decreasing sequence that converges to $1$ and additionally we have that $\e' > \e$, so $\frac{\e'}{\e} >1$.	From the definition of the limit, we know that there exists large enough $N \in \N$, such that $|\lambda \cdot r_{N}-1| \leq \frac{\e'}{\e} - 1$. We can simplify the above relying on the fact that $\lambda \cdot r_n \geq 1$ for all $n \in \N$ and obtain that indeed $\e' \geq \e \cdot \lambda \cdot r_N$ as desired. 
	
		Since $\e \cdot r_N \geq \e \cdot \lambda^{-1} \geq \lambda^{n}$, we can apply induction hypothesis and obtain that $\vdash e \equiv_{\e \cdot r_N} g^* \seq f$. Since $\emptyword \notin \sem{e}$, we can now use \Cref{c2:lem:generalised_pref} to derive that $e \seq g \equiv_{\e'} e \seq e^{\ast} \seq f$. Since we have shown it for arbitrary $\e' > \e$, we can use $(\Cont)$ rule of the quantitative deduction systems and conclude that $\vdash e \seq g \equiv_{\e} e \seq e^* \seq f$, as desired. 
		
		
		Then, because of $(\Refl)$, we have that $\vdash f \equiv_0 f$. We can combine those two quantitative inferences using \textsf{(SL5)} axiom in order to get $\vdash e \seq g + f \equiv_{\e} e \seq e^\ast \seq f  + f $. By assumption, the left hand side satisfies that $\vdash g \equiv_0 e \seq g + f$. Now, consider the right hand side of that quantitative inference:
	\begin{align*}
		\vdash e \seq e^{\ast} \seq f + f &\equiv_0 e \seq e^\ast \seq f + \one \seq f \tag{\textsf{1S}} \\
		&\equiv_0 (e \seq e^* + \one) \seq f \tag{\textsf{D2}} \\
		&\equiv_0 e^{*} \seq f \tag{\textsf{Unroll}}
	\end{align*}
	We can combine the reasoning above and conclude (using $(\Triang)$) that $\vdash g \equiv_{\e} e^\ast \seq f$.
\end{proof}
Having the result above, we can now use the infinitary $(\Cont)$ rule capturing the limiting property of decreasing chain of overapproximations to the distance and show the derivability of Salomaa's inference rule.
\begin{lemma}
	Let $e,f,g \in \RExp$, such that $\emptyword \notin \sem{e}$. Then, $\{g \equiv_0 e \seq g + f\} \vdash g \equiv_{0} e^{\ast} \seq f$ is derivable using the axioms of \textsf{REG}.

\end{lemma}
\begin{proof}
To deduce that $\vdash g \equiv_0 e^{\ast} \seq f$ using $(\Cont)$ it suffices to show that $\vdash g \equiv_{\e} e^{\ast} \seq f$ for all $\e > 0$.  To do so, pick an arbitrary $\e > 0$ and let $N = \lceil \log_{\lambda} \e \rceil$. Observe that $\lambda^N = \lambda^{\lceil \log_{\lambda} \e \rceil} \leq \lambda^{\log_{\lambda} \e} = \e$. Because of \Cref{c2:lem:star_lemma} we have that $\vdash g \equiv_{\e} e^{\ast} \seq f$, which completes the proof.
\end{proof}
\section{Completeness}\label{c2:sec:completeness}
We now focus our attention on the central result of this paper, which is the completeness of \textsf{REG} with respect to the shortest-distinguishing-word metric on languages denoting regular expressions. We use the strategy from the proof of completeness of quantitative axiomatisation of probabilistic bisimilarity distance~\cite{Bacci:2018:Bisimilarity}. It turns out that the results from~\cite{Bacci:2018:Bisimilarity} rely on properties that are not unique to the Kantorovich/Wassertstein lifting and can be also established for instances of the abstract coalgebraic framework~\cite{Baldan:2018:Coalgebraic}.

The heart of our argument relies on the fact that the distance between languages denoting regular expressions can be calculated in a simpler way than applying the Knaster-Tarski fixpoint theorem while looking at the infinite-state final automaton of all formal languages over some fixed alphabet. 

In particular, regular expressions denote the behaviour of finite-state deterministic automata. Since automata homomorphisms are nonexpansive mappings, the distance between languages $\sem{e}$ and $\sem{f}$ of some arbitrary regular expressions $e, f \in \RExp$ is the same as the distance between states in some DFA whose languages corresponds to $\sem{e}$ and $\sem{f}$. To be precise, we will look at the finite subautomaton $\gen{[e]_{\acirel}, [f]_{\acirel}}{\mathcal{Q}}$ of the $\acirel$ quotient of the Brzozowski automaton. The reason we care about deterministic finite automata is that it turns out that one can calculate the behavioural distance between two states through an iterative approximation from above, which can be also derived axiomatically using the $(\Cont)$ rule of quantitative deduction systems. We start by showing how this simplification works, and then we establish completeness.
\subsection{Behavioural distance of finite-state automata}\label{c2:subsec:distance_finite_automata}
Consider a deterministic automaton $\mathcal{M} = (M, \langle o_M, t_M\rangle)$. The least fixpoint of a monotone endomap $\Phi_{\langle o_M, t_M\rangle} \colon D_{M} \to D_{M}$ on the complete lattice of pseudometrics on the set $M$ results in $d_{\langle o_M, t_M\rangle}$.
It is noteworthy that $\Phi_{\langle o_M, t_M\rangle}$ exhibits two generic properties. Firstly, $\Phi_{\langle o_M, t_M\rangle}$ behaves well within the Banach space structure defined by the supremum norm.
\begin{lemma}\label{c2:lem:operator_nonexpansive}
	For any deterministic automaton $\mathcal{M} = (M, \langle o_M, t_M\rangle)$,  $\Phi_{\langle o_M, t_M\rangle} \colon D_M \to D_M$ is contractive with respect to the supremum norm. In other words, for all $d, d' \in D_M$ we have that
    $$\|\Phi_{\langle o_M, t_M\rangle}(d') - \Phi_{\langle o_M, t_M\rangle}(d) \| \leq \lambda \cdot\|d' - d \|$$
\end{lemma}
\begin{proof}
    We can safely assume that $d \sqsubseteq d'$, as other case will be symmetric. It sufices to show that for all $m, m' \in M$, $\Phi_{\langle o_M, t_M\rangle}(d')(m,m') - \Phi_{\langle o_M, t_M\rangle}(d)(m,m') \leq \|d' - d \|$. First, let's consider the case when $o_M(m) \neq o_M(m')$ and hence $d_{\{0,1\}}(m,m')=1$. In such a scenario, it holds that $$\Phi_{\langle o_M, t_M\rangle}(d')(m,m') - \Phi_{\langle o_M, t_M\rangle}(d)(m,m') = 0 \leq \lambda \cdot \|d'-d \|$$ 
    
    From now on, we will assume that $o_M(m) = o_M(m)$ and hence $d_{\{0,1\}}(m,m')=0$. We have the following:
    \begin{align*}
        \Phi_{\langle o_M, t_M\rangle}(d')(m,m') - \Phi_{\langle o_M, t_M\rangle}(d)(m,m') &= \lambda \cdot \max_{a \in \alphabet} d'(m_a, m'_a) - \lambda \cdot \max_{a \in \alphabet} d(m_a, m'_a) \\
        &= \lambda \cdot \left( \max_{a \in \alphabet} d'(m_a, m'_a) - \max_{a \in \alphabet} d(m_a,  m'_a) \right) \\
        &\leq \lambda \cdot \left(\max_{a \in \alphabet} \{d'(m_a, m'_a) - d(m_a, m'_a) \}\right) \\  
        &\leq \lambda \cdot \sup_{n,n' \in M} \{ d'(n,n') - d(n,n')\} \\
        &= \lambda \cdot \|d' - d \| \qedhere
    \end{align*}
\end{proof}
Secondly, contractivity of $\Phi_{\langle o_M, t_M\rangle}$ implies the following:
\begin{corollary}\label{c2:lem:uniquefp}
    For any deterministic automaton $\mathcal{M} = (M, \langle o_M, t_M\rangle)$, $\Phi_{\langle o_M, t_M\rangle}$ has a unique fixed point.
\end{corollary}
This means that if we want to calculate $d_{\langle o_M, t_M\rangle}$ it suffices to look at any fixpoint of $\Phi_{\langle o_M, t_M\rangle}$. This will enable a simpler characterisation, than the one given by the Knaster-Tarski fixpoint theorem. In particular, we will rely on the characterisation given by the Kleene's fixpoint theorem~\cite[Theorem~2.8.5]{Sangiorgi:2011:Coinduction}, which allows to obtain the greatest fixpoint of an endofunction on the lattice as the infimum of the decreasing sequence of finer approximations obtained by repeatedly applying the function to the top element of the lattice.

\begin{theorem}[Kleene's fixpoint theorem]\label{c2:thm:kleene}
	Let $(X, \sqsubseteq)$ be a complete lattice with a top element $\top$ and $f \colon X \to X$ an endofunction that is $\omega$-cocontinuous or in other words for any decreasing chain $\{x_i\}_{i \in \N}$ it holds that $$\inf_{i \in \N} \{f(x_i)\} = f \left( \inf_{i \in \N} \{ x_i \} \right)$$  
	Then, $f$ possesses a greatest fixpoint, given by 
	$\operatorname{gfp}(f) = \inf_{i \in \N }\{f^{(i)}(\top)\}$
	where $f^{(n)}$ denotes $n$-fold self-composition of $f$ given inductively by $f^{(0)}(x)=x$ and $f^{(n+1)}(x) = f^{(n+1)}(f(x))$ for all $x \in X$.
\end{theorem} 
The theorem above requires the endomap to be $\omega$-cocontinuous. Luckily, it is the case for $\Phi_{\langle o_M, t_M\rangle}$ if we restrict our attention to \textsf{DFA}. To show that, we directly follow the line of reasoning from~\cite[Lemma~5.6]{Bacci:2018:Bisimilarity} generalising the similar line of reasoning for $\omega$-continuity from \cite[Theorem~1]{Breugel:2012:On}. First, using  \Cref{c2:lem:chain_pointwise_inf} we show that decreasing chains of pseudometrics over a finite set converge to their infimum. That result is a minor re-adaptation of~\cite[Theorem~1]{Breugel:2012:On} implicitly used in \cite[Lemma~5.6]{Bacci:2018:Bisimilarity}.
\begin{lemma}\label{c2:lem:chain_conv_to_inf}
    Let $\{d_i\}_{i \in \N}$ be an infinite descending chain in the lattice $(D_X, \sqsubseteq)$, where $X$ is a finite set. The sequence $\{d_i\}_{i \in \N}$ converges (in the sense of convergence in the Banach space) to $d(x,y) = \inf_{i \in \N} d_i(x,y)$.
\end{lemma}
\begin{proof}
     Let $\e > 0$ and let $x, y \in X$. Since $d(x,y) = \inf_{i \in \N} d_i(x,y)$ 
    there exists an index $m_{x,y} \in \N$ such that for all $n \geq m_{x,y}$, $|d_n(x,y) - d(x,y)| < \e$. Now, let $N = \max \{m_{x,y} \mid x, y \in X\}$. This is well-defined because $X$ is finite. Therefore, for all $n \geq N$ and $x,y \in X$, $| d_n(x,y) - d(x,y)|< \e$ and hence $\| d_n - d\| < \e$.
\end{proof}
We can now use the above to show the desired property, by re-adapting \cite[Theorem~1]{Breugel:2012:On}. 
\begin{lemma}\label{c2:lem:cocontinuous} If $\mathcal{M} = (M, \langle o_M, t_M\rangle) $ is a deterministic finite automaton, then $\Phi_{\langle o_M, t_M\rangle}$ is $\omega$-cocontinuous.\end{lemma} 
\begin{proof}
 By \Cref{c2:lem:chain_conv_to_inf}, the chain $\{d_i\}_{i \in \N}$ converges to $\inf_{i \in \N} d_i$. Since $\Phi_{\langle o_M, t_M\rangle}$ is contractive (\Cref{c2:lem:operator_nonexpansive}) it is also continuous (in the sense of the Banach space continuity) and therefore $\{\Phi_{\langle o_M, t_M\rangle}(d_i)\}_{i \in \N}$ converges to $\Phi_{\langle o_M, t_M\rangle} \left(\inf_{i \in \N} d_i\right)$. Recall that $\Phi_{\langle o_M, t_M\rangle}$ is monotone, which makes $\{\Phi_{\langle o_M, t_M\rangle}(d_i)\}_{i \in \N}$ into a chain, which by \Cref{c2:lem:chain_pointwise_inf} and \Cref{c2:lem:chain_conv_to_inf} converges to $\inf_{i \in \N} \{\Phi_{\langle o_M, t_M\rangle} (d_i)\}$. Since limit points are unique, $\inf_{i \in \N} \{\Phi_{\langle o_M, t_M\rangle} (d_i)\} = \Phi_{\langle o_M, t_M\rangle} \left(\inf_{i \in \N} d_i\right)$.
\end{proof}
We can combine the preceding results and provide a straightforward characterisation of the distance between languages represented by arbitrary regular expressions, denoted as $e, f \in \RExp$. Utilising a simple argument based on \Cref{c2:lem:behavioural_distances_properties}, which asserts that automata homomorphisms are isometries, one can demonstrate that the distance between $\sem{e}$ and $\sem{f}$ in the final automaton is equivalent to the distance between $[e]_{\acirel}$ and $[f]_{\acirel}$ in $\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$. This is, the least subautomaton of $\mathcal{Q}$ that contains the derivatives (modulo $\acirel$) reachable from $[e]_{\acirel}$ and $[f]_{\acirel}$. Importantly, this automaton is finite (\Cref{c2:lem:locally_finite}), allowing us to apply the Kleene's fixpoint theorem to calculate the distance.

Let ${\Psi}_{e,f}^{(0)}$ denote the discrete metric on the set $\gen{[e]{\acirel},[f]{\acirel}}{\mathcal{Q}}$ (the top element of the lattice of pseudometrics over that set). Define ${\Psi}_{e,f}^{(n+1)} = \Phi_{\gen{[e]{\acirel},[f]{\acirel}}{\mathcal{Q}}} \left({\Psi}_{e,f}^{(n)}\right)$. Additionally, leveraging the fact that infima of decreasing chains are calculated pointwise (\Cref{c2:lem:chain_pointwise_inf}), we can conclude with the following:
\begin{lemma}\label{c2:lem:iterative_calculation}
For all $e,f \in \RExp$, the underlying pseudometric of the quantitative algebra $\qalgB$ can be given by $d^{\qalgB}(e,f) = \inf_{i \in \N} \left\{ {\Psi}_{e,f}^{(i)}\left([e]_{\acirel}, [f]_{\acirel}\right)\right\} $
\end{lemma}
\begin{proof}
    Recall that $d^{\qalgB} = \langmetric \circ (\sem{-} \times \sem{-})$. Moreover, the canonical quotient map $[-]_{\acirel} \colon \RExp \to \aciq$ is an automaton homomorphism from $\mathcal{R}$ to $\mathcal{Q}$. Composing it with a language assigning homomorphism $L_{\mathcal{Q}} \colon \aciq \to \pset(\alphabet^\ast)$ yields an automaton homomorphism $L_{\mathcal{Q}} \circ [-]_{\acirel} \colon \RExp \to \pset(\alphabet^\ast)$, which by finality must be the same as $L_{\mathcal{R}} \colon \RExp \to \pset(\alphabet^\ast)$, and thus (by \Cref{c2:lem:adequacy}) the same as $\sem{-}$. Using the fact that automata homomorphisms are isometries (\Cref{c2:lem:behavioural_distances_properties}), we can derive the following:
    \begin{align*}
    d^{\qalgB} &= \langmetric \circ (\sem{-} \times \sem{-})\\
    &= \langmetric \circ ((L_{\mathcal{Q}} \circ ([-]_{\acirel}) \times (L_{\mathcal{Q}} \circ ([-]_{\acirel}))\\
    &= \langmetric \circ (L_{\mathcal{Q}} \times L_{\mathcal{Q}}) \circ ([-]_{\acirel} \times [-]_{\acirel})\\
    &= d_{\langle o_{\mathcal{Q}}, t_{\mathcal{Q}} \rangle} \circ ([-]_{\acirel} \times [-]_{\acirel}) \tag{\Cref{c2:lem:behavioural_distances_properties}}
    \end{align*}
    Additionally, since $\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$ is the subautomaton of $\mathcal{Q}$ containing all the derivatives (modulo $\acirel$) of $e$ and $f$, the canonical inclusion map $\iota \colon \gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}} \hookrightarrow \mathcal{Q}$ is a deterministic automaton homomorphism. Because $\iota([e]_{\acirel})=[e]_{\acirel}$ and $\iota([f]_{\acirel})=[f]_{\acirel}$, we can again use \Cref{c2:lem:behavioural_distances_properties} to show that
    $$
    d^{\qalgB}(e,f) = d_{\langle o_{\mathcal{Q}}, t_{\mathcal{Q}} \rangle}([e]_\acirel,[f]_\acirel) = d_{\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}}([e]_{\acirel}, [f]_{\acirel})
    $$
    Because of the fact that $([e]_{\acirel}, [f]_{\acirel})$ has finitely many states (\cref{c2:lem:locally_finite}) then by \Cref{c2:lem:uniquefp}, \Cref{c2:lem:cocontinuous} and \Cref{c2:thm:kleene} one can use the simplified iterative formula to calculate the behavioural pseudometric of $\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$.
\end{proof}

In simpler terms, we have demonstrated that the behavioural distance between a pair of arbitrary regular expressions can be calculated as the infimum of decreasing approximations of the actual distance from above. 

Alternatively, one could calculate the same distance as the supremum of increasing approximations from below using the Kleene's fixpoint theorem for the least fixpoint. We chose the former approach because our proof of completeness relies on the $(\Cont)$ rule of quantitative deduction systems. This rule essentially states that to prove two terms are at a specific distance, we should be able to prove that for all approximations of that distance from above. This allows us to replicate the fixpoint calculation through axiomatic reasoning.
\subsection{Completeness result}\label{c2:subsec:completeness_result}

We start by recalling that regular expressions satisfy a certain decomposition property, stating that each expression can be reconstructed from its small-step semantics, up to $\equiv_0$. This property, often referred to as the fundamental theorem of regular expressions (in analogy with the fundamental theorem of calculus and following the terminology of Rutten~\cite{Rutten:2000:Universal} and Silva~\cite{Silva:2010:Kleene}) is useful in further steps of the proof of completeness. We will make use of the $n$-ary generalised sum operator, which is well defined because of \textsf{(SL1-SL4)} axioms of \textsf{REG}.
\begin{theorem}{Fundamental Theorem}\label{c2:thm:fundamental_theorem}
    For any $e \in \RExp$, $$
    \vdash e \equiv_0 \sum_{a \in \alphabet} a \seq (e)_a + o_{\mathcal{R}}(e)
    $$ is derivable using the axioms of \textsf{REG}.
\end{theorem}
\begin{proof}
	See~\cite[Theorem~4.4]{Brzozowski:1964:Expressions} or~\cite[Lemma~4]{Salomaa:1966:Two}.
\end{proof}
%\begin{proof}
%We proceed by induction on $e \in \RExp$. The base cases are trivial, so we just demonstrate the case when $e = a$ for $a \in \alphabet$. 
%
%    \fbox{$e = a$} 
%    \begin{align*}
%       \vdash a &\equiv_{0} a \seq \one \tag{$\mathsf{S1}$}\\
%        &\equiv_0 a \seq 1 + \zero \tag{$\mathsf{SL4}$}\\
%        &\equiv_0 a \seq (a)_a + o_{\mathcal{R}}(a) \tag{Def. of derivatives}
%    \end{align*}
%    Now, observe that for all $a' \in \alphabet \setminus \{a\}$, we have that $(a)_a' = 0$. Using axiom ($\mathsf{S0}$), $a' \seq (a)_{a'} \equiv_0 0$. Through induction on the size of $A \setminus \{a\}$, using axioms ($\mathsf{SL1}$) and ($\mathsf{SL4}$), one can show that $\sum_{a' \in \alphabet \setminus \{a \}} a' \seq (a)_{a'} \equiv_0 0$. We can now combine the intermediate results into the following:
%    \begin{align*}
%       \vdash a &\equiv_0 a \seq (a)_a + o_{\mathcal{R}}(a) \tag{Previous derivations} \\
%        &\equiv_0  a \seq (a)_a + o_{\mathcal{R}}(a) + \zero \tag{$\mathsf{SL1}$} \\
%        &\equiv_0 a \seq (a)_a + \zero + o_{\mathcal{R}}(a) \tag{$\mathsf{SL2}$} \\
%        &\equiv_0 a \seq (a)_a + \sum_{a' \in \alphabet \setminus \{a\}} a' \seq (a)_{a'} + o_{\mathcal{R}}(a) \tag{Previous inductive argument} \\
%        &\equiv_0 \sum_{a' \in \alphabet} a' \seq (a)_{a'} + o_{\mathcal{R}}(a) \tag{Def. of $n$-ary sum}
%    \end{align*}
%
%    \fbox{$e = f + g$}
%    \begin{align*}
%        \vdash f + g &\equiv_0 \left(\sum_{a \in \alphabet} a \seq (f)_a + o_{\mathcal{R}}(f)\right) + \left(\sum_{a \in \alphabet} a \seq (g)_a + o_{\mathcal{R}}(g)\right) \tag{Induction hypothesis} \\
%        &\equiv_0 \sum_{a \in \alphabet}\left( a \seq (f)_a + a \seq (g)_a\right) + \left( o_{\mathcal{R}}(f) + o_{\mathcal{R}}(g)\right) \tag{$\mathsf{S3}$}\\
%        &\equiv_0 \sum_{a \in \alphabet}\left( a \seq \left((f)_a + (g)_a\right)\right) + \left( o_{\mathcal{R}}(f) + o_{\mathcal{R}}(g)\right) \tag{$\mathsf{D1}$}\\
%        &\equiv_0 \sum_{a \in \alphabet}\left( a \seq \left((f + g)_a\right)\right) + o_{\mathcal{R}}(f + g)  \tag{Def. of derivatives}\\
%    \end{align*}
%
%    \fbox{$e = f \seq g $}
%    \begin{align*}
%        \vdash f \seq g &\equiv_0 \left(\sum_{a \in \alphabet} a \seq (f)_a + o_{\mathcal{R}}(f)\right) \seq g \tag{Induction hypothesis} \\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq (f)_a \seq g  + o_{\mathcal{R}}(f) \seq g \tag{$\mathsf{D2}$} \\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq (f)_a \seq g  + o_{\mathcal{R}}(f) \seq \left(\sum_{a \in \alphabet} a \seq (g)_a + o_{\mathcal{R}}(g) \right) \tag{Induction hypothesis} \\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq (f)_a \seq g  +  \left(\sum_{a \in \alphabet}  o_{\mathcal{R}}(f) \seq a \seq (g)_a + o_{\mathcal{R}}(f) \seq o_{\mathcal{R}}(g) \right) \tag{$\mathsf{D1}$} \\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq (f)_a \seq g  +  \left(\sum_{a \in \alphabet} a \seq  o_{\mathcal{R}}(f) \seq (g)_a + o_{\mathcal{R}}(f) \seq o_{\mathcal{R}}(g) \right) \tag{($\mathsf{1S}$) and ($\mathsf{S1}$) if $o_{\mathcal{R}}(f)=1$ or ($\mathsf{0S}$) and ($\mathsf{S0}$) if $o_{\mathcal{R}}(f)=0$} \\
%        &\equiv_0 \sum_{a \in \alphabet} \left(a \seq (f)_a \seq g  +  a \seq  o_{\mathcal{R}}(f) \seq (g)_a \right) + o_{\mathcal{R}}(f) \seq o_{\mathcal{R}}(g) \tag{$\mathsf{SL3}$}\\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq \left((f)_a \seq g  +  o_{\mathcal{R}}(f) \seq (g)_a \right) + o_{\mathcal{R}}(f) \seq o_{\mathcal{R}}(g) \tag{$\mathsf{D1}$}\\
%        &\equiv_0 \sum_{a \in \alphabet} a \seq \left(f \seq g\right)_a + o_{\mathcal{R}}(f \seq g) \tag{Def. of derivatives}\\
%    \end{align*}
%
%    \fbox{$e = f^\ast$}
%    \begin{align*}
%        \vdash f^{\ast} &\equiv_0 \left( \sum_{a \in \alphabet} a \seq (f)_a + o_{\mathcal{R}}(f)\right)^{\ast} \tag{Induction hypothesis}\\
%        &\equiv_0 \left(\sum_{a \in \alphabet} a \seq (f)_a\right)^{\ast} \tag{($\mathsf{Tight}$) if $o_{\mathcal{R}}=1$ or ($\mathsf{SL4}$) if $o_{\mathcal{R}}=0$} \\
%        &\equiv_0  \left(\sum_{a \in \alphabet} a \seq (f)_a\right) \seq  \left(\sum_{a \in \alphabet} a \seq (f)_a\right)^{\ast} + \one \tag{$\mathsf{Unroll}$}\\
%        &\equiv_0  \left(\sum_{a \in \alphabet} a \seq (f)_a\right) \seq  f^{\ast} + \one \tag{Steps 1-2 and $(\Nexp)$} \\
%        &\equiv_0 \left(\sum_{a \in \alphabet} a \seq (f)_a \seq  f^{\ast} \right)  + \one \tag{$\mathsf{D2}$}\\
%        &\equiv_0 \left(\sum_{a \in \alphabet} a \seq \left(f^{\ast}\right)_a \right)  + o_{\mathcal{R}}\left(f^{\ast}\right) \tag{Def. of derivatives}\\
%    \end{align*}
%    
%\end{proof}
 Let's now say that we are interested in the distance between some expressions $e,f \in \RExp$. As mentioned before, we will rely on $\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$, the least subautomaton of the $\acirel$ quotient of the Brzozowski automaton containing states reachable from $[e]_{\acirel}$ and $[f]_{\acirel}$. Recall that by \Cref{c2:lem:locally_finite} its state space is finite. It turns out that the approximations from above (from \Cref{c2:lem:iterative_calculation}) to the distance between any pair of states in that automaton can be derived through the means of axiomatic reasoning.
\begin{lemma}\label{c2:lem:provability1}
	Let $e,f \in \RExp$ be arbitrary regular expressions and let $[g]_{\acirel}, [h]_{\acirel} \in \gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$. 
       For all $i \in \N$, and $\e \geq {\Psi}_{e,f}^{(i)}\left([g]_{\acirel}, [h]_{\acirel}\right)$, one can derive $\vdash g \equiv_{\e} h$ using the axioms of \textsf{REG}.
\end{lemma}
\begin{proof}

We proceed by induction on $i$. 

For the base case, observe that ${\Psi}_{e,f}^{(0)}$ is the discrete pseudometric on the set $\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}$ such that ${\Psi}_{e,f}^{(0)}([g]_{\acirel}, [h]_{\acirel})=0$ if and only if ${{g} \acirel {h}}$, or otherwise ${\Psi}_{e,f}^{(0)}([g]_{\acirel}, [h]_{\acirel})=1$. 

In the first case, we immediately have that $g \equiv_0 h$, because $\acirel$ is contained in distance zero axioms of \textsf{REG}. In the latter case, we can just use $(\Top)$, to show that $g \equiv_1 h $. Then, in both cases, we can apply $(\Max)$ to obtain $\vdash g \equiv_{\e} h$, since $\e \geq {\Psi}_{e,f}^{(0)}([g]_{\acirel}, [h]_{\acirel})$.
	
For the induction step, let $i = j + 1$ and derive the following:
\begin{align*}
    &\e \geq {\Psi}_{e,f}^{(j + 1)}([g]_{\acirel}, [h]_{\acirel})
    \iff \e \geq \Phi_{\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}} \left( {\Psi}_{e,f}^{(j)} \right)\left([g]_{\acirel}, [h]_{\acirel}\right) \tag{Def. of ${\Psi}_{e,f}^{j+1}$}\\
    \iff &\e \geq \max\left\{ d_{\{0,1\}} (o_{\mathcal{Q}}({[g]}_{\acirel}), o_{\mathcal{Q}}([h]_{\acirel})), \lambda \cdot \max_{a \in \alphabet} \left\{ {\Psi}_{e,f}^{(j)}\left({[g]_{\acirel}}_a, {[h]_{\acirel}}_{a}\right) \right\}\right\} \tag{Def. of $\Phi$}\\
    \iff &\e \geq \max\left\{ d_{\{0,1\}} \left(o_{\mathcal{R}}(g), o_{\mathcal{R}}(h)\right), \lambda \cdot \max_{a \in \alphabet} \left\{ \Phi_{\gen{[e]_{\acirel},[f]_{\acirel}}{\mathcal{Q}}}^{(j)}\left({[{(g)}_{a}]_{\acirel}}, {[{(h)}_{a}]_{\acirel}}\right) \right\}\right\} \tag{Def. of $\mathcal{Q}$}\\
    \iff &{\e \geq d_{\{0,1\}} (o_{\mathcal{R}}(g), o_{\mathcal{R}}(h))} \text{ and for all $a \in \alphabet$},~\e \cdot \lambda^{-1} \geq {\Psi}_{e,f}^{(j)}\left({[{(g)}_{a}]_{\acirel}}, {[{(h)}_{a}]_{\acirel}}\right)
\end{align*}

Firstly, since $d_{\{0,1\}}$ is the discrete pseudometric on the set $\{0,1\}$, we can use $(\Refl)$ or $(\Top)$ depending on whether $o_{\mathcal{R}}(g) = o_{\mathcal{R}}(h)$ and then apply $(\Max)$ to derive $\vdash o_{\mathcal{R}}(g) \equiv_\e o_{\mathcal{R}}(h)$. 

Let $a \in \alphabet$. We will show that $\vdash a\seq (g)_a \equiv_{\e} a \seq (h)_a $. Since $\e \cdot \lambda^{-1}$ is not guaranteed to be rational, we cannot immediately apply the induction hypothesis. Instead, we rely on \textsf{(Cont)} rule. 

First, pick an arbitrary rational $\e'$ strictly greater than $\e$ and fix $\{r_n\}_{n \in \N}$ to be any decreasing sequence of rationals that converges to $\lambda^{-1}$. Let $r_N$ be an element of that sequence such that $\e' \geq \lambda \cdot \e \cdot r_N$. It is always possible to pick such element because $\{\lambda \cdot r_n\}_{n \in \N}$ is a decreasing sequence that converges to $1$ and $\e' > \e$. 

Since $\e \cdot r_N \geq \e \cdot \lambda^{-1}$ and $\e \cdot r_{N} \in \Q$, we can use the induction hypothesis and derive $\vdash (g)_a \equiv_{\e \cdot r_{N}} (h_a)$. Then, by $(\dPref)$ axiom we have that $\vdash a \seq (g)_a \equiv_{\e'} a \seq (h)_a$. Since we have shown it for arbitrary $\e' > \e$, by \textsf{(Cont)} rule we have that $\vdash a\seq (g)_a \equiv_{\e} a \seq (h)_a $. Using \textsf{(SL5)}, we can combine all subexpressions involving the output and transition derivatives into the following:
	$$
	\vdash \sum_{a \in \alphabet} a \seq (g)_a + o_{\mathcal{R}}(g) \equiv_{\e} \sum_{a \in \alphabet} a \seq (h)_a + o_{\mathcal{R}}(h)
	$$
	Since both sides are normal forms of $g$ and $h$ existing because of \Cref{c2:thm:fundamental_theorem}, we can apply \textsf{(Triang)} on both sides and obtain $\vdash g \equiv_{\e} h$ thus completing the proof.
\end{proof}
At this point, we have done all the hard work, and establishing completeness involves a straightforward argument that utilises the \textsf{(Cont)} rule and the lemma above.
\begin{theorem}[Completeness]\label{c2:completeness}
       For any $e, f \in \RExp$ and $\e \in \Q$, if $\models_\qalgB e \equiv_\e f$, then $\vdash e \equiv_\e f \in \mathsf{REG}$
\end{theorem}
\begin{proof}
    Assume that $ \models_\qalgB e \equiv_\e f $, which by the definition of $\models_{\qalgB}$ is equivalent to $d^{\qalgB}(e,f) \leq \e$. In order to use \textsf{(Cont)} axiom to derive $\vdash e \equiv_\e f$, we need to be able to show $\vdash e \equiv_{\e'} f$ for all $\e' > \e$. Because of iterative characterisation of $d^{\qalgB}$ from \Cref{c2:lem:iterative_calculation}, we have that $\inf_{i \in \N} \{{\Psi}_{e,f}^{(i)}([e]_{\acirel},[f]_{\acirel})\} < \e'$. Since $\e'$ is strictly above the infimum of the descending chain of approximants, there exists a point $i \in \N$, such that $\e' > {\Psi}_{e,f}^{(i)} \left([e]_{\acirel}, [f]_{\acirel}\right)$. We can show this by contradiction. 
    
    Assume that for all $i \in \N$, $\e' \leq {\Psi}_{e,f}^{(i)}\left([e]_{\acirel}, [f]_{\acirel}\right)$. 
     This would make $\e'$ into the lower bound of the chain $\left\{{\Psi}_{e,f}^{(i)}([e]_{\acirel}, [f]_{\acirel})\right\}_{i \in \N}$ and in such a case $\e'$ would be less than or equal to the infimum of that chain, which by assumption is less than or equal to $\e$. By transitivity, we could obtain $\e' \leq \e$. Since $\e' > \e$, by antisymmetry we could derive that $\e'= \e$, which would lead to the contradiction. 

    Using the fact shown above, we can use \Cref{c2:lem:provability1} to obtain $\vdash e \equiv_{\e'} f \in \mathsf{REG}$ for any $\e' > \e$, which completes the proof.
\end{proof}
\section{Discussion}\label{c2:sec:discussion}
We have presented a sound and complete axiomatisation of the shortest-distinguishing word distance between languages representing regular expressions through a quantitative analogue of equational logic~\cite{Mardare:2016:Quantitative}. Outside of the coalgebra community, the shortest-distinguishing word distance and its variants also appear in the model checking~\cite{Kwiatkowska:1990:Metric} and the automata learning~\cite{Ferreira:2022:Tree} literature.

Early works on axiomatising behavioural distances relied on ad-hoc inference systems. The earliest example of such a system was presented by Larsen, Fahrenberg and Thrane~\cite{Larsen:2011:Metrics}, who focused on the directed simulation distance of streams of elements equipped with a metric space structure. Later work of D'Argenio, Gebler and Lee~\cite{Argenio:2014:Axiomatizing} studied systematic axiomatisations of behavioural between processes featuring both probability and nondeterminism definable through the PGSOS rule format. It is important to note that the inference system of D'Argenio et al contained a powerful rule internalising the definition of Kantorovich lifting as an inference rule.

The introduction of quantitative equational theories~\cite{Mardare:2016:Quantitative} made more principled approaches possible. Bacci, Mardare, Panangaden and Plotkin~\cite{Bacci:2018:Algebraic} axiomatised bisimilarity metric of Markov processes~\cite{Desharnais:2004:Metrics} and in the later work similarly considered behavioural distance of Mealy machines and Markov decision processes~\cite{Bacci:2024:Sum}. Those results crucially hinged on the quantitative generalisations of results from universal algebra, such as the notion of the tensor of algebraic theories. It is worth noting that specification languages used in those axiomatisations did not feature separate primitives for introducing recursion.

An alternative approach was proposed by Bacci, Bacci, Larsen and Mardare~\cite{Bacci:2018:Bisimilarity}, who used a mild relaxation of quantitative equational theories and gave a sound and complete axiomatisation of bisimulation distance between terms of probabilistic process calculus of Stark and Smolka~\cite{Stark:2000:Complete} and later adapted their results to a coarser notion of total variation distance between infinite traces~\cite{Bacci:2018:TV}. 

We have followed the strategy for proving completeness from~\cite{Bacci:2018:Bisimilarity}. The interesting insight about that strategy is that it relies on properties that are not exclusive to distances obtained through the Kantorovich lifting and can be established for notions of behavioural distance for other kinds of transition systems stemming from the coalgebraic framework. In particular, one needs to show that the monotone map on the lattice of pseudometrics used in defining the distance of finite-state systems is nonexpansive with respect to the sup norm (and hence $\omega$-cocontinuous) and has a unique fixpoint, thus allowing to characterise the behavioural distance as the greatest fixpoint obtained through the Kleene's fixpoint theorem. This point of view allows one to reconstruct the fixpoint calculation in terms of axiomatic manipulation involving the \textsf{(Cont)} rule, eventually leading to completeness.

We have additionally observed that in the presence of the infinitary \textsf{(Cont)} rule and the \textsf{(\dPref)} axiom, there is no need for a fixpoint introduction rule, which is commonplace in axiomatisations of language equivalence regular expressions but also other work on process calculi. Inrestingly, the previous work on axiomatising a discounted probabilistic bisimilarity distance from~\cite{Bacci:2018:Bisimilarity} includes both \textsf{(\dPref)} and the fixpoint introduction rule, but its proof of completeness~\cite[Theorem~6.4]{Bacci:2018:Bisimilarity} does not involve the fixpoint introduction rule at any point. We are highly confident that in the case of that axiomatisation, the fixpoint introduction rule could be derived from other axioms in a similar fashion to the way we derived Salomaa's rule for introducing the Kleene star~\cite{Salomaa:1966:Two}. Additionally, we are interested in how much this argument relates to the recent study of fixpoints in quantitative equational theories~\cite{Mardare:2021:Fixed}. 

In this chapter, we have focused on the simplest and most intuitive instantiation of the coalgebraic framework in the case of deterministic automata, but the natural next step would be to generalise our results to a wider class of transition systems. A good starting point could be to consider coalgebras for \emph{polynomial} endofunctors, in the fashion of the framework of \emph{Kleene Coalgebra}~\cite{Silva:2010:Kleene}. Alternatively, it would be interesting to look at recent work on a family of process algebras parametric on an equational theory representing the branching constructs~\cite{Schmid:2022:Processes} and study its generalisations to quantitative equational theories. A related and interesting avenue for future work are equational axiomatisations of behavioural equivalence of Guarded Kleene Algebra with Tests (GKAT)~\cite{Smolka:2020:Guarded,Schmid:2022:Processes} and its probabilistic extension (ProbGKAT)~\cite{Rozowski:2023:Probabilistic}, whose completeness results rely on a powerful uniqueness of solutions axiom (UA). The soundness of UA in both cases is shown through an involved argument relying on equipping the transition systems giving the operational semantics with a form of behavioural distance and showing that recursive specifications describing finite-state systems correspond to certain contractive mappings. It may be more sensible, particularly for ProbGKAT to consider quantitative axiomatisations in the first place and give the proofs of completeness through the pattern explored in this chapter.
